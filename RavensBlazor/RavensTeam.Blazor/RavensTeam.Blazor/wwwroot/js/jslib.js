var jslib;(()=>{var e={383:function(e,t){var r="undefined"!=typeof self?self:this,n=function(){function e(){this.fetch=!1,this.DOMException=r.DOMException}return e.prototype=r,new e}();!function(e){!function(t){var r="URLSearchParams"in e,n="Symbol"in e&&"iterator"in Symbol,s="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),i="FormData"in e,a="ArrayBuffer"in e;if(a)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(e){return e&&o.indexOf(Object.prototype.toString.call(e))>-1};function c(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function u(e){return"string"!=typeof e&&(e=String(e)),e}function d(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function h(e){this.map={},e instanceof h?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function p(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function g(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function _(e){var t=new FileReader,r=g(t);return t.readAsArrayBuffer(e),r}function m(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function y(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:s&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:i&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:r&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():a&&s&&(t=e)&&DataView.prototype.isPrototypeOf(t)?(this._bodyArrayBuffer=m(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a&&(ArrayBuffer.prototype.isPrototypeOf(e)||l(e))?this._bodyArrayBuffer=m(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},s&&(this.blob=function(){var e=p(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?p(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(_)}),this.text=function(){var e,t,r,n=p(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,r=g(t=new FileReader),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(b)}),this.json=function(){return this.text().then(JSON.parse)},this}h.prototype.append=function(e,t){e=c(e),t=u(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},h.prototype.delete=function(e){delete this.map[c(e)]},h.prototype.get=function(e){return e=c(e),this.has(e)?this.map[e]:null},h.prototype.has=function(e){return this.map.hasOwnProperty(c(e))},h.prototype.set=function(e,t){this.map[c(e)]=u(t)},h.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},h.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),d(e)},h.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),d(e)},h.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),d(e)},n&&(h.prototype[Symbol.iterator]=h.prototype.entries);var w=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function f(e,t){var r,n,s=(t=t||{}).body;if(e instanceof f){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new h(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,s||null==e._bodyInit||(s=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new h(t.headers)),this.method=(n=(r=t.method||this.method||"GET").toUpperCase(),w.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&s)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(s)}function b(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),s=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(s))}})),t}function v(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new h(t.headers),this.url=t.url||"",this._initBody(e)}f.prototype.clone=function(){return new f(this,{body:this._bodyInit})},y.call(f.prototype),y.call(v.prototype),v.prototype.clone=function(){return new v(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},v.error=function(){var e=new v(null,{status:0,statusText:""});return e.type="error",e};var x=[301,302,303,307,308];v.redirect=function(e,t){if(-1===x.indexOf(t))throw new RangeError("Invalid status code");return new v(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function I(e,r){return new Promise((function(n,i){var a=new f(e,r);if(a.signal&&a.signal.aborted)return i(new t.DOMException("Aborted","AbortError"));var o=new XMLHttpRequest;function l(){o.abort()}o.onload=function(){var e,t,r={status:o.status,statusText:o.statusText,headers:(e=o.getAllResponseHeaders()||"",t=new h,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var s=r.join(":").trim();t.append(n,s)}})),t)};r.url="responseURL"in o?o.responseURL:r.headers.get("X-Request-URL");var s="response"in o?o.response:o.responseText;n(new v(s,r))},o.onerror=function(){i(new TypeError("Network request failed"))},o.ontimeout=function(){i(new TypeError("Network request failed"))},o.onabort=function(){i(new t.DOMException("Aborted","AbortError"))},o.open(a.method,a.url,!0),"include"===a.credentials?o.withCredentials=!0:"omit"===a.credentials&&(o.withCredentials=!1),"responseType"in o&&s&&(o.responseType="blob"),a.headers.forEach((function(e,t){o.setRequestHeader(t,e)})),a.signal&&(a.signal.addEventListener("abort",l),o.onreadystatechange=function(){4===o.readyState&&a.signal.removeEventListener("abort",l)}),o.send(void 0===a._bodyInit?null:a._bodyInit)}))}I.polyfill=!0,e.fetch||(e.fetch=I,e.Headers=h,e.Request=f,e.Response=v),t.Headers=h,t.Request=f,t.Response=v,t.fetch=I,Object.defineProperty(t,"__esModule",{value:!0})}({})}(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var s=n;(t=s.fetch).default=s.fetch,t.fetch=s.fetch,t.Headers=s.Headers,t.Request=s.Request,t.Response=s.Response,e.exports=t},287:e=>{e.exports.L=!1},923:(e,t,r)=>{"use strict";var n=String.prototype.replace,s=/%20/g,i=r(162),a={RFC1738:"RFC1738",RFC3986:"RFC3986"};e.exports=i.assign({default:a.RFC3986,formatters:{RFC1738:function(e){return n.call(e,s,"+")},RFC3986:function(e){return String(e)}}},a)},944:(e,t,r)=>{"use strict";var n=r(162),s=Object.prototype.hasOwnProperty,i=Array.isArray,a={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:n.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},o=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},l=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},c=function(e,t){if(i(e)){for(var r=[],n=0;n<e.length;n+=1)r.push(t(e[n]));return r}return t(e)},u=function(e,t,r,n){if(e){var i=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,a=/(\[[^[\]]*])/g,o=r.depth>0&&/(\[[^[\]]*])/.exec(i),c=o?i.slice(0,o.index):i,u=[];if(c){if(!r.plainObjects&&s.call(Object.prototype,c)&&!r.allowPrototypes)return;u.push(c)}for(var d=0;r.depth>0&&null!==(o=a.exec(i))&&d<r.depth;){if(d+=1,!r.plainObjects&&s.call(Object.prototype,o[1].slice(1,-1))&&!r.allowPrototypes)return;u.push(o[1])}return o&&u.push("["+i.slice(o.index)+"]"),function(e,t,r,n){for(var s=n?t:l(t,r),i=e.length-1;i>=0;--i){var a,o=e[i];if("[]"===o&&r.parseArrays)a=[].concat(s);else{a=r.plainObjects?Object.create(null):{};var c="["===o.charAt(0)&&"]"===o.charAt(o.length-1)?o.slice(1,-1):o,u=parseInt(c,10);r.parseArrays||""!==c?!isNaN(u)&&o!==c&&String(u)===c&&u>=0&&r.parseArrays&&u<=r.arrayLimit?(a=[])[u]=s:a[c]=s:a={0:s}}s=a}return s}(u,t,r,n)}};e.exports=function(e,t){var r=function(e){if(!e)return a;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?a.charset:e.charset;return{allowDots:void 0===e.allowDots?a.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:a.allowPrototypes,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:a.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:a.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:a.comma,decoder:"function"==typeof e.decoder?e.decoder:a.decoder,delimiter:"string"==typeof e.delimiter||n.isRegExp(e.delimiter)?e.delimiter:a.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:a.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:a.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:a.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:a.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:a.strictNullHandling}}(t);if(""===e||null==e)return r.plainObjects?Object.create(null):{};for(var d="string"==typeof e?function(e,t){var r,u={},d=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,h=t.parameterLimit===1/0?void 0:t.parameterLimit,p=d.split(t.delimiter,h),g=-1,_=t.charset;if(t.charsetSentinel)for(r=0;r<p.length;++r)0===p[r].indexOf("utf8=")&&("utf8=%E2%9C%93"===p[r]?_="utf-8":"utf8=%26%2310003%3B"===p[r]&&(_="iso-8859-1"),g=r,r=p.length);for(r=0;r<p.length;++r)if(r!==g){var m,y,w=p[r],f=w.indexOf("]="),b=-1===f?w.indexOf("="):f+1;-1===b?(m=t.decoder(w,a.decoder,_,"key"),y=t.strictNullHandling?null:""):(m=t.decoder(w.slice(0,b),a.decoder,_,"key"),y=c(l(w.slice(b+1),t),(function(e){return t.decoder(e,a.decoder,_,"value")}))),y&&t.interpretNumericEntities&&"iso-8859-1"===_&&(y=o(y)),w.indexOf("[]=")>-1&&(y=i(y)?[y]:y),s.call(u,m)?u[m]=n.combine(u[m],y):u[m]=y}return u}(e,r):e,h=r.plainObjects?Object.create(null):{},p=Object.keys(d),g=0;g<p.length;++g){var _=p[g],m=u(_,d[_],r,"string"==typeof e);h=n.merge(h,m,r)}return n.compact(h)}},870:(e,t,r)=>{"use strict";var n=r(162),s=r(923),i=Object.prototype.hasOwnProperty,a={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},o=Array.isArray,l=Array.prototype.push,c=function(e,t){l.apply(e,o(t)?t:[t])},u=Date.prototype.toISOString,d=s.default,h={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:n.encode,encodeValuesOnly:!1,format:d,formatter:s.formatters[d],indices:!1,serializeDate:function(e){return u.call(e)},skipNulls:!1,strictNullHandling:!1},p=function e(t,r,s,i,a,l,u,d,p,g,_,m,y){var w,f=t;if("function"==typeof u?f=u(r,f):f instanceof Date?f=g(f):"comma"===s&&o(f)&&(f=f.join(",")),null===f){if(i)return l&&!m?l(r,h.encoder,y,"key"):r;f=""}if("string"==typeof(w=f)||"number"==typeof w||"boolean"==typeof w||"symbol"==typeof w||"bigint"==typeof w||n.isBuffer(f))return l?[_(m?r:l(r,h.encoder,y,"key"))+"="+_(l(f,h.encoder,y,"value"))]:[_(r)+"="+_(String(f))];var b,v=[];if(void 0===f)return v;if(o(u))b=u;else{var x=Object.keys(f);b=d?x.sort(d):x}for(var I=0;I<b.length;++I){var C=b[I];a&&null===f[C]||(o(f)?c(v,e(f[C],"function"==typeof s?s(r,C):r,s,i,a,l,u,d,p,g,_,m,y)):c(v,e(f[C],r+(p?"."+C:"["+C+"]"),s,i,a,l,u,d,p,g,_,m,y)))}return v};e.exports=function(e,t){var r,n=e,l=function(e){if(!e)return h;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||h.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=s.default;if(void 0!==e.format){if(!i.call(s.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var n=s.formatters[r],a=h.filter;return("function"==typeof e.filter||o(e.filter))&&(a=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:h.addQueryPrefix,allowDots:void 0===e.allowDots?h.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:h.charsetSentinel,delimiter:void 0===e.delimiter?h.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:h.encode,encoder:"function"==typeof e.encoder?e.encoder:h.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:h.encodeValuesOnly,filter:a,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:h.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:h.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:h.strictNullHandling}}(t);"function"==typeof l.filter?n=(0,l.filter)("",n):o(l.filter)&&(r=l.filter);var u,d=[];if("object"!=typeof n||null===n)return"";u=t&&t.arrayFormat in a?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var g=a[u];r||(r=Object.keys(n)),l.sort&&r.sort(l.sort);for(var _=0;_<r.length;++_){var m=r[_];l.skipNulls&&null===n[m]||c(d,p(n[m],m,g,l.strictNullHandling,l.skipNulls,l.encode?l.encoder:null,l.filter,l.sort,l.allowDots,l.serializeDate,l.formatter,l.encodeValuesOnly,l.charset))}var y=d.join(l.delimiter),w=!0===l.addQueryPrefix?"?":"";return l.charsetSentinel&&("iso-8859-1"===l.charset?w+="utf8=%26%2310003%3B&":w+="utf8=%E2%9C%93&"),y.length>0?w+y:""}},162:e=>{"use strict";var t=Object.prototype.hasOwnProperty,r=Array.isArray,n=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),s=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(r[n]=e[n]);return r};e.exports={arrayToObject:s,assign:function(e,t){return Object.keys(t).reduce((function(e,r){return e[r]=t[r],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],s=0;s<t.length;++s)for(var i=t[s],a=i.obj[i.prop],o=Object.keys(a),l=0;l<o.length;++l){var c=o[l],u=a[c];"object"==typeof u&&null!==u&&-1===n.indexOf(u)&&(t.push({obj:a,prop:c}),n.push(u))}return function(e){for(;e.length>1;){var t=e.pop(),n=t.obj[t.prop];if(r(n)){for(var s=[],i=0;i<n.length;++i)void 0!==n[i]&&s.push(n[i]);t.obj[t.prop]=s}}}(t),e},decode:function(e,t,r){var n=e.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(e){return n}},encode:function(e,t,r){if(0===e.length)return e;var s=e;if("symbol"==typeof e?s=Symbol.prototype.toString.call(e):"string"!=typeof e&&(s=String(e)),"iso-8859-1"===r)return escape(s).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var i="",a=0;a<s.length;++a){var o=s.charCodeAt(a);45===o||46===o||95===o||126===o||o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122?i+=s.charAt(a):o<128?i+=n[o]:o<2048?i+=n[192|o>>6]+n[128|63&o]:o<55296||o>=57344?i+=n[224|o>>12]+n[128|o>>6&63]+n[128|63&o]:(a+=1,o=65536+((1023&o)<<10|1023&s.charCodeAt(a)),i+=n[240|o>>18]+n[128|o>>12&63]+n[128|o>>6&63]+n[128|63&o])}return i},isBuffer:function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},merge:function e(n,i,a){if(!i)return n;if("object"!=typeof i){if(r(n))n.push(i);else{if(!n||"object"!=typeof n)return[n,i];(a&&(a.plainObjects||a.allowPrototypes)||!t.call(Object.prototype,i))&&(n[i]=!0)}return n}if(!n||"object"!=typeof n)return[n].concat(i);var o=n;return r(n)&&!r(i)&&(o=s(n,a)),r(n)&&r(i)?(i.forEach((function(r,s){if(t.call(n,s)){var i=n[s];i&&"object"==typeof i&&r&&"object"==typeof r?n[s]=e(i,r,a):n.push(r)}else n[s]=r})),n):Object.keys(i).reduce((function(r,n){var s=i[n];return t.call(r,n)?r[n]=e(r[n],s,a):r[n]=s,r}),o)}}},617:(e,t,r)=>{e.exports=r(684)},684:(e,t,r)=>{var n=r(961);t.operation=function(e){var r=t.timeouts(e);return new n(r,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],s=0;s<t.retries;s++)n.push(this.createTimeout(s,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(s,t)),n.sort((function(e,t){return e-t})),n},t.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,n=Math.round(r*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return Math.min(n,t.maxTimeout)},t.wrap=function(e,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var s in n=[],e)"function"==typeof e[s]&&n.push(s);for(var i=0;i<n.length;i++){var a=n[i],o=e[a];e[a]=function(n){var s=t.operation(r),i=Array.prototype.slice.call(arguments,1),a=i.pop();i.push((function(e){s.retry(e)||(e&&(arguments[0]=s.mainError()),a.apply(this,arguments))})),s.attempt((function(){n.apply(e,i)}))}.bind(e,o),e[a].options=r}}},961:e=>{function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var n=this;return this._timer=setTimeout((function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)}),r),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var s=this._errors[n],i=s.message,a=(e[i]||0)+1;e[i]=a,a>=r&&(t=s,r=a)}return t}}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{"use strict";function e(e){return"string"==typeof e?e:"number"==typeof e?e.toString(10):e.id}function t(e){return"string"==typeof e?e:e.name}r.r(n),r.d(n,{getMyUserName:()=>$n});class s{constructor(e){if(this.clientId=e,this.authorizationType="Extension",this.currentScopes=[],!("Twitch"in globalThis))throw new Error("This is not an extension, or you didn't load the Twitch Extension Helper properly.")}getCurrentScopesForUser(){return[]}async getAccessTokenForUser(t,...r){if(r.length&&r.some((e=>null==e?void 0:e.length)))throw new Error(`Scopes ${r.filter((e=>Boolean(e))).map((e=>e.join("|"))).join(", ")} requested but direct extension calls do not support scopes. Please use an EBS instead.`);return{...await this.getAnyAccessToken(),userId:e(t)}}async getAnyAccessToken(){const e=Twitch.ext.viewer.helixToken;if(null==e)throw new Error("Could not retrieve an access token from the Twitch extension environment. This could mean different things:\n\t\t\t\n- You're in a mobile extension or the Extension Developer Rig. This is a known issue that has to be resolved by Twitch.\n- You didn't wait for the onAuthorized callback before doing any API calls. Before this callback fires, a token is not available.");return{accessToken:e,refreshToken:null,expiresIn:null,obtainmentTimestamp:Date.now(),scope:[]}}async refreshAccessTokenForUser(e){return await this.getAccessTokenForUser(e)}}var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},i(e,t)};function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function o(e,t,r,n){var s,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(i<3?s(a):i>3?s(t,r,a):s(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a}function l(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,s,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){s={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(s)throw s.error}}return a}function c(e,t,r){if(r||2===arguments.length)for(var n,s=0,i=t.length;s<i;s++)!n&&s in t||(n||(n=Array.prototype.slice.call(t,0,s)),n[s]=t[s]);return e.concat(n||Array.prototype.slice.call(t))}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var u,d,h=r(287);function p(e){if("number"==typeof e){if(Object.prototype.hasOwnProperty.call(d,e))return e;var t=Object.keys(d).map((function(e){return parseInt(e,10)})).filter((function(t){return!isNaN(t)&&t<e}));return t.length?Math.max.apply(Math,t):d.WARNING}var r=e.replace(/\d+$/,"").toUpperCase();if(!Object.prototype.hasOwnProperty.call(d,r))throw new Error("Unknown log level string: ".concat(e));return d[r]}!function(e){e[e.CRITICAL=0]="CRITICAL",e[e.ERROR=1]="ERROR",e[e.WARNING=2]="WARNING",e[e.INFO=3]="INFO",e[e.DEBUG=4]="DEBUG",e[e.TRACE=7]="TRACE"}(d||(d={}));var g,_,m=h.L?console.log.bind(console):console.debug.bind(console),y=((u={})[d.CRITICAL]=console.error.bind(console),u[d.ERROR]=console.error.bind(console),u[d.WARNING]=console.warn.bind(console),u[d.INFO]=console.info.bind(console),u[d.DEBUG]=m.bind(console),u[d.TRACE]=console.trace.bind(console),u);function w(e){return null==e}function f(e,t){return w(e)?null:t(e)}function b(e,t){return w(e)?void 0:t(e)}var v="undefined"==typeof process?[]:null!==(_=null===(g=process.env.LOGGING)||void 0===g?void 0:g.split(";").map((function(e){var t=e.split("=",2),r=t[0],n=t[1];return n?["default"===r?void 0:r.split(":"),p(n)]:null})).filter((function(e){return!!e})).sort((function(e,t){var r,n,s=e[0],i=t[0];return(null!==(r=null==i?void 0:i.length)&&void 0!==r?r:0)-(null!==(n=null==s?void 0:s.length)&&void 0!==n?n:0)})))&&void 0!==_?_:[],x=v.findIndex((function(e){return!e[0]})),I=void 0;function C(e,t){return t.length<=e.length&&t.every((function(t,r){return t===e[r]}))}function S(e){for(var t=e.split(":"),r=0,n=v;r<n.length;r++){var s=n[r],i=s[0],a=s[1];if(C(t,i))return a}return I}-1!==x&&(I=v[x][1],v.splice(x));var A,B,T,E=function(){function e(e){var t,r,n=e.name,s=e.minLevel,i=e.emoji,a=void 0!==i&&i,o=e.colors,l=e.timestamps,c=void 0===l?h.L:l;this._name=n,this._minLevel=null!==(r=null!==(t=b(s,(function(e){return p(e)})))&&void 0!==t?t:S(n))&&void 0!==r?r:d.WARNING,this._emoji=a,this._colors=o,this._timestamps=c}return e.prototype.crit=function(e){this.log(d.CRITICAL,e)},e.prototype.error=function(e){this.log(d.ERROR,e)},e.prototype.warn=function(e){this.log(d.WARNING,e)},e.prototype.info=function(e){this.log(d.INFO,e)},e.prototype.debug=function(e){this.log(d.DEBUG,e)},e.prototype.trace=function(e){this.log(d.TRACE,e)},e}(),U=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.log=function(e,t){if(!(e>this._minLevel)){var r=y[e],n="[".concat(this._name,"] ").concat(t);this._timestamps&&(n="[".concat((new Date).toISOString(),"] ").concat(t)),r(n)}},t}(E),D=function(){function e(e){var t,r=e.name,n=e.minLevel,s=e.custom;this._minLevel=null!==(t=b(n,(function(e){return p(e)})))&&void 0!==t?t:S(r),this._override="function"==typeof s?{log:s}:s}return e.prototype.log=function(e,t){this._shouldLog(e)&&this._override.log(e,t)},e.prototype.crit=function(e){this._override.crit?this._shouldLog(d.CRITICAL)&&this._override.crit(e):this.log(d.CRITICAL,e)},e.prototype.error=function(e){this._override.error?this._shouldLog(d.ERROR)&&this._override.error(e):this.log(d.ERROR,e)},e.prototype.warn=function(e){this._override.warn?this._shouldLog(d.WARNING)&&this._override.warn(e):this.log(d.WARNING,e)},e.prototype.info=function(e){this._override.info?this._shouldLog(d.INFO)&&this._override.info(e):this.log(d.INFO,e)},e.prototype.debug=function(e){this._override.debug?this._shouldLog(d.DEBUG)&&this._override.debug(e):this.log(d.DEBUG,e)},e.prototype.trace=function(e){this._override.trace?this._shouldLog(d.TRACE)&&this._override.trace(e):this.log(d.TRACE,e)},e.prototype._shouldLog=function(e){return void 0===this._minLevel||this._minLevel>=e},e}(),q=((A={})[d.CRITICAL]="🛑",A[d.ERROR]="❌",A[d.WARNING]="⚠️ ",A[d.INFO]="ℹ️ ",A[d.DEBUG]="🐞",A[d.TRACE]="🐾",A),P={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,blackBright:90,redBright:91,greenBright:92,yellowBright:93,blueBright:94,magentaBright:95,cyanBright:96,whiteBright:97},R={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgBlackBright:100,bgRedBright:101,bgGreenBright:102,bgYellowBright:103,bgBlueBright:104,bgMagentaBright:105,bgCyanBright:106,bgWhiteBright:107};function O(e,t,r){return function(n){return"[".concat(e,"m").concat(r?r(n):n,"[").concat(t,"m")}}function k(e){return O(P[e],39)}function N(e,t){return O(R[e],49,t)}var j=((B={})[d.CRITICAL]=k("red"),B[d.ERROR]=k("redBright"),B[d.WARNING]=k("yellow"),B[d.INFO]=k("blue"),B[d.DEBUG]=k("magenta"),B[d.TRACE]=O(0,0),B),F=((T={})[d.CRITICAL]=N("bgRed",k("white")),T[d.ERROR]=N("bgRedBright",k("white")),T[d.WARNING]=N("bgYellow",k("black")),T[d.INFO]=N("bgBlue",k("white")),T[d.DEBUG]=N("bgMagenta",k("black")),T[d.TRACE]=O(7,27),T),H=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.log=function(e,t){var r,n,s;if(!(e>this._minLevel)){var i=y[e],a="";if(this._timestamps&&(a+="[".concat((new Date).toISOString(),"] ")),this._emoji){var o=q[e];a+="".concat(o," ")}i(a+=null===(s=null!==(r=this._colors)&&void 0!==r?r:null===(n=process.stdout)||void 0===n?void 0:n.isTTY)||void 0===s||s?"".concat(F[e](this._name)," ").concat(F[e](d[e])," ").concat(j[e](t)):"[".concat(this._name,":").concat(d[e].toLowerCase(),"] ").concat(t))}},t}(E);function M(e){return e.custom?new D(e):h.L?new H(e):new U(e)}class L extends Error{constructor(...e){var t;super(...e),Object.setPrototypeOf(this,new.target.prototype),null===(t=Error.captureStackTrace)||void 0===t||t.call(Error,this,new.target.constructor)}get name(){return this.constructor.name}}class G extends L{}class $ extends L{constructor(e){super(`Need to retry after ${e} ms`),this._retryAt=Date.now()+e}get retryAt(){return this._retryAt}}class W{constructor({logger:e}){this._queue=[],this._batchRunning=!1,this._paused=!1,this._logger=M({name:"rate-limiter",emoji:!0,...e})}async request(e,t){return this._logger.trace("request start"),await new Promise(((r,n)=>{var s;const i={req:e,resolve:r,reject:n,limitReachedBehavior:null!==(s=null==t?void 0:t.limitReachedBehavior)&&void 0!==s?s:"enqueue"};this._batchRunning||this._nextBatchTimer||this._paused?(this._logger.trace(`request queued batchRunning:${this._batchRunning.toString()} hasNextBatchTimer:${(!!this._nextBatchTimer).toString()} paused:${this._paused.toString()}`),this._queue.push(i)):this._runRequestBatch([i])}))}clear(){this._queue=[]}pause(){this._paused=!0}resume(){this._paused=!1,this._runNextBatch()}get stats(){var e,t,r,n,s;return{lastKnownLimit:null!==(t=null===(e=this._parameters)||void 0===e?void 0:e.limit)&&void 0!==t?t:null,lastKnownRemainingRequests:null!==(n=null===(r=this._parameters)||void 0===r?void 0:r.remaining)&&void 0!==n?n:null,lastKnownResetDate:f(null===(s=this._parameters)||void 0===s?void 0:s.resetsAt,(e=>new Date(e)))}}async _runRequestBatch(e){this._logger.trace(`runRequestBatch start specs:${e.length}`),this._batchRunning=!0,this._parameters&&this._logger.debug(`Remaining requests: ${this._parameters.remaining}`),this._logger.debug(`Doing ${e.length} requests, new queue length is ${this._queue.length}`);const t=e.map((async e=>{const{req:t,resolve:r,reject:n}=e;try{const n=await this.doRequest(t),s=this.needsToRetryAfter(n);if(null!==s)throw this._queue.unshift(e),this._logger.info(`Retrying after ${s} ms`),new $(s);const i=this.getParametersFromResponse(n);return r(n),i}catch(e){if(e instanceof $)throw e;return void n(e)}})),r=await Promise.allSettled(t),n=r.filter((e=>"rejected"===e.status)),s=Date.now();if(n.length){this._logger.trace("runRequestBatch some rejected");const e=Math.max(s,...n.map((e=>e.reason.retryAt)))-s;this._logger.warn(`Waiting for ${e} ms because the rate limit was exceeded`),this._nextBatchTimer=setTimeout((()=>{this._parameters=void 0,this._runNextBatch()}),e)}else{this._logger.trace("runRequestBatch none rejected");const e=r.filter((e=>"fulfilled"===e.status&&void 0!==e.value)).map((e=>e.value)).reduce(((e,t)=>e?t.remaining<e.remaining?t:e:t),void 0);if(this._batchRunning=!1,e)if(this._parameters=e,e.resetsAt<s||e.remaining>0)this._logger.trace("runRequestBatch canRunMore"),this._runNextBatch();else{const t=e.resetsAt-s;this._logger.trace(`runRequestBatch delay:${t}`),this._logger.warn(`Waiting for ${t} ms because the rate limit was reached`),this._queue=this._queue.filter((e=>{switch(e.limitReachedBehavior){case"enqueue":return!0;case"null":return e.resolve(null),!1;case"throw":return e.reject(new G("Request removed from queue because the rate limit was reached")),!1;default:throw new Error("this should never happen")}})),this._nextBatchTimer=setTimeout((()=>{this._parameters=void 0,this._runNextBatch()}),t)}}this._logger.trace("runRequestBatch end")}_runNextBatch(){if(this._paused)return;this._logger.trace("runNextBatch start"),this._nextBatchTimer&&(clearTimeout(this._nextBatchTimer),this._nextBatchTimer=void 0);const e=this._parameters?Math.min(this._parameters.remaining,this._parameters.limit/10):1,t=this._queue.splice(0,e);t.length&&this._runRequestBatch(t),this._logger.trace("runNextBatch end")}}class V{constructor(e){this._children=new Map,this._paused=!1,this._partitionKeyCallback=e.getPartitionKey,this._createChildCallback=e.createChild}async request(e,t){const r=this._partitionKeyCallback(e),n=this._getChild(r);return await n.request(e,t)}clear(){for(const e of this._children.values())e.clear()}pause(){this._paused=!0;for(const e of this._children.values())e.pause()}resume(){this._paused=!1;for(const e of this._children.values())e.resume()}getChildStats(e){if(!this._children.has(e))return null;const t=this._children.get(e);return t instanceof W?t.stats:null}_getChild(e){if(this._children.has(e))return this._children.get(e);const t=this._createChildCallback(e);return this._paused&&t.pause(),this._children.set(e,t),t}}class z{constructor({logger:e,bucketSize:t,timeFrame:r,doRequest:n,getPartitionKey:s}){this._partitionedQueue=new Map,this._usedFromBucket=new Map,this._paused=!1,this._logger=M({name:"rate-limiter",emoji:!0,...e}),this._bucketSize=t,this._timeFrame=r,this._callback=n,this._partitionKeyCallback=s}async request(e,t){return await new Promise(((r,n)=>{var s,i;const a={req:e,resolve:r,reject:n,limitReachedBehavior:null!==(s=null==t?void 0:t.limitReachedBehavior)&&void 0!==s?s:"enqueue"},o=this._partitionKeyCallback(e),l=null!==(i=this._usedFromBucket.get(o))&&void 0!==i?i:0;if(l>=this._bucketSize||this._paused)switch(a.limitReachedBehavior){case"enqueue":{const e=this._getPartitionedQueue(o);e.push(a),l+e.length>=this._bucketSize?this._logger.warn(`Rate limit of ${this._bucketSize} for ${o?`partition ${o}`:"default partition"} was reached, waiting for ${this._paused?"the limiter to be unpaused":"a free bucket entry"}; queue size is ${e.length}`):this._logger.info(`Enqueueing request for ${o?`partition ${o}`:"default partition"} because the rate limiter is paused; queue size is ${e.length}`);break}case"null":a.resolve(null),this._paused?this._logger.info(`Returning null for request for ${o?`partition ${o}`:"default partition"} because the rate limiter is paused`):this._logger.warn(`Rate limit of ${this._bucketSize} for ${o?`partition ${o}`:"default partition"} was reached, dropping request and returning null`);break;case"throw":a.reject(new G("Request dropped because "+(this._paused?"the rate limiter is paused":`the rate limit for ${o?`partition ${o}`:"default partition"} was reached`)));break;default:throw new Error("this should never happen")}else this._runRequest(a,o)}))}clear(){this._partitionedQueue.clear()}pause(){this._paused=!0}resume(){this._paused=!1;for(const e of this._partitionedQueue.keys())this._runNextRequest(e)}_getPartitionedQueue(e){if(this._partitionedQueue.has(e))return this._partitionedQueue.get(e);const t=[];return this._partitionedQueue.set(e,t),t}async _runRequest(e,t){var r;const n=this._getPartitionedQueue(t);this._logger.debug(`doing a request for ${t?`partition ${t}`:"default partition"}, new queue length is ${n.length}`),this._usedFromBucket.set(t,(null!==(r=this._usedFromBucket.get(t))&&void 0!==r?r:0)+1);const{req:s,resolve:i,reject:a}=e;try{i(await this._callback(s))}catch(e){a(e)}finally{setTimeout((()=>{const e=this._usedFromBucket.get(t)-1;this._usedFromBucket.set(t,e),n.length&&e<this._bucketSize&&this._runNextRequest(t)}),this._timeFrame)}}_runNextRequest(e){if(this._paused)return;const t=this._getPartitionedQueue(e).shift();t&&this._runRequest(t,e)}}var Q=r(383),K=r(870);r(944),r(923);class J extends Error{constructor(e,t){var r;super(e,t),Object.setPrototypeOf(this,new.target.prototype),null===(r=Error.captureStackTrace)||void 0===r||r.call(Error,this,new.target.constructor)}get name(){return this.constructor.name}}class Y extends J{constructor(e,t,r,n,s,i){super(`Encountered HTTP status code ${e}: ${t}\n\nURL: ${r}\nMethod: ${n}\nBody:\n${!i&&s.length>150?`${s.slice(0,147)}...`:s}`),this._statusCode=e,this._url=r,this._method=n,this._body=s}get statusCode(){return this._statusCode}get url(){return this._url}get method(){return this._method}get body(){return this._body}}async function X(e,t){var r;if(!e.ok){const n="application/json"===e.headers.get("Content-Type"),s=n?JSON.stringify(await e.json(),null,2):await e.text(),i=K(t.query,{arrayFormat:"repeat",addQueryPrefix:!0}),a=`${t.url}${i}`;throw new Y(e.status,e.statusText,a,null!==(r=t.method)&&void 0!==r?r:"GET",s,n)}}async function Z(e){if(204===e.status)return;const t=await e.text();return t?JSON.parse(t):void 0}async function ee(e,t,r,n,s={},i){var a,o;const l=null!==(a=e.type)&&void 0!==a?a:"helix",c=function(e,t,r){switch(t){case"helix":{const t=e.replace(/^\//,"");return r?"eventsub/subscriptions"===t?`http://localhost:${r}/${t}`:`http://localhost:${r}/mock/${t}`:`https://api.twitch.tv/helix/${t}`}case"auth":return`https://id.twitch.tv/oauth2/${e.replace(/^\//,"")}`;default:return e}}(e.url,l,i),u=K(e.query,{arrayFormat:"repeat",addQueryPrefix:!0}),d=new Q.Headers({Accept:"application/json"});let h;e.jsonBody&&(h=JSON.stringify(e.jsonBody),d.append("Content-Type","application/json")),t&&"auth"!==l&&d.append("Client-ID",t),r&&d.append("Authorization",`${"helix"===l?null!=n?n:"Bearer":"OAuth"} ${r}`);const p={...s,method:null!==(o=e.method)&&void 0!==o?o:"GET",headers:d,body:h};return await Q(`${c}${u}`,p)}function te(e,t,r){return n=>{const s=r?function(){return`[${t}#${this[r]} - please check https://twurple.js.org/reference/${e}/classes/${t}.html for available properties]`}:function(){return`[${t} - please check https://twurple.js.org/reference/${e}/classes/${t}.html for available properties]`};Object.defineProperty(n.prototype,Symbol.for("nodejs.util.inspect.custom"),{value:s,enumerable:!1})}}class re extends J{}class ne extends W{async doRequest({options:e,clientId:t,accessToken:r,authorizationType:n,fetchOptions:s,mockServerPort:i}){return await ee(e,t,r,n,s,i)}needsToRetryAfter(e){return 429!==e.status||e.headers.has("ratelimit-remaining")&&0!==Number(e.headers.get("ratelimit-remaining"))?null:1e3*+e.headers.get("ratelimit-reset")-Date.now()}getParametersFromResponse(e){const{headers:t}=e;return{limit:+t.get("ratelimit-limit"),remaining:+t.get("ratelimit-remaining"),resetsAt:1e3*+t.get("ratelimit-reset")}}}function se(e){switch(typeof e){case"undefined":return"";case"object":{if(null===e)return"";if("cacheKey"in e)return e.cacheKey;const t=JSON.stringify(e);if("{}"!==t)return t}default:return e.toString()}}function ie(e,t,r){return[e,...t.map(se)].join("/")+(r?"/":"")}function ae(e=1/0){return function(t,r,n){if(n.get){const t=n.get;n.get=function(){const n=ie(r,[]),s=this.getFromCache(n);if(s)return s;const i=t.call(this);return this.setCache(n,i,e),i}}return n}}const oe=Symbol("cache");function le(e){var t,r;return r=class extends e{constructor(){super(...arguments),this[t]=new Map}getFromCache(e){if(this._cleanCache(),this[oe].has(e)){const t=this[oe].get(e);if(t)return t.value}}setCache(e,t,r){this[oe].set(e,{value:t,expires:Date.now()+1e3*r})}removeFromCache(e,t){const r=this._getInternalCacheKey(e,t);t?this[oe].forEach(((e,t)=>{t.startsWith(r)&&this[oe].delete(t)})):this[oe].delete(r)}_cleanCache(){const e=Date.now();this[oe].forEach(((t,r)=>{t.expires<e&&this[oe].delete(r)}))}_getInternalCacheKey(e,t){if("string"==typeof e){let t=e;return t.endsWith("/")||(t+="/"),t}return ie(e.shift(),e,t)}},t=oe,r}function ce(){var e,t;return{promise:new Promise((function(r,n){e=r,t=n})),resolve:e,reject:t}}class ue{constructor(e,t,r,n=!1){this.owner=e,this.event=t,this.listener=r,this._internal=n}unbind(){this.owner.removeListener(this)}}class de{constructor(){this._eventListeners=new Map,this._internalEventListeners=new Map}on(e,t){return this._addListener(!1,e,t)}addListener(e,t){return this._addListener(!1,e,t)}removeListener(e,t){this._removeListener(!1,e,t)}registerEvent(){const e=t=>this.addListener(e,t);return e}emit(e,...t){if(this._eventListeners.has(e))for(const r of this._eventListeners.get(e))r(...t);if(this._internalEventListeners.has(e))for(const r of this._internalEventListeners.get(e))r(...t)}registerInternalEvent(){const e=t=>this.addInternalListener(e,t);return e}addInternalListener(e,t){return this._addListener(!0,e,t)}removeInternalListener(e,t){this._removeListener(!0,e,t)}_addListener(e,t,r){const n=e?this._eventListeners:this._internalEventListeners;return n.has(t)?n.get(t).push(r):n.set(t,[r]),new ue(this,t,r,e)}_removeListener(e,t,r){const n=e?this._eventListeners:this._internalEventListeners;if(t)if("object"==typeof t){const e=t;this._removeListener(e._internal,e.event,e.listener)}else{const e=t;if(n.has(e))if(r){const t=n.get(e);let s=0;for(;-1!==(s=t.indexOf(r));)t.splice(s,1)}else n.delete(e)}else n.clear()}}const he=Symbol("twurpleRawData");class pe{constructor(e){this[he]=e}}let ge=class extends pe{constructor(e){super(e),this._obtainmentDate=new Date}get clientId(){return this[he].client_id}get userId(){var e;return null!==(e=this[he].user_id)&&void 0!==e?e:null}get userName(){var e;return null!==(e=this[he].login)&&void 0!==e?e:null}get scopes(){return this[he].scopes}get expiryDate(){return f(this[he].expires_in,(e=>new Date(this._obtainmentDate.getTime()+1e3*e)))}};ge=o([te("auth","TokenInfo","clientId")],ge);class _e extends J{constructor(e){super("Invalid token supplied",e)}}function me(e){var t;return null!==(t=f(function(e){return f(e.expiresIn,(t=>e.obtainmentTimestamp+1e3*t-6e4))}(e),(e=>Date.now()>e)))&&void 0!==t&&t}class ye extends J{constructor(e){super(`${e} - this should never happen, please file a bug in the GitHub issue tracker`)}}var we=r(617);function fe(t){return{broadcaster_id:e(t)}}function be(e={}){const{count:t=10,period:r="all",startDate:n,contextUserId:s}=e;return{count:t.toString(),period:r,started_at:null==n?void 0:n.toISOString(),user_id:s}}function ve(e){return void 0===e&&(e=!0),function(t,r){Object.defineProperty(t,r,{get:function(){},set:function(t){Object.defineProperty(this,r,{value:t,writable:!0,enumerable:e})},enumerable:e})}}class xe{constructor(e){this._client=e}_getUserContextIdWithDefault(e){var t;return null!==(t=this._client._getUserIdFromRequestContext(e))&&void 0!==t?t:e}}o([ve(!1)],xe.prototype,"_client",void 0);class Ie extends J{constructor(){super("Relation returned null - this may be a library bug or a race condition in your own code")}}function Ce(e){if(null==e)throw new Ie;return e}let Se=class extends pe{constructor(e,t){super(e),this._client=t}get userId(){return this[he].user_id}get userName(){return this[he].user_login}get userDisplayName(){return this[he].user_name}get rank(){return this[he].rank}get amount(){return this[he].score}async getUser(){return Ce(await this._client.users.getUserById(this[he].user_id))}};o([ve(!1)],Se.prototype,"_client",void 0),Se=o([te("api","HelixBitsLeaderboardEntry","userId")],Se);let Ae=class extends pe{constructor(e,t){super(e),this._client=t}get entries(){return this[he].data.map((e=>new Se(e,this._client)))}get totalCount(){return this[he].total}};function Be(e,t){if("function"!=typeof t){var r=t;t=function(e){return e[r].toString()}}return function(e){return Object.assign.apply(Object,c([{}],l(e.map((function(e){var r;return(r={})[t(e)]=e,r}))),!1))}(e)}o([ve(!1)],Ae.prototype,"_client",void 0),o([ae()],Ae.prototype,"entries",null),Ae=o([le,te("api","HelixBitsLeaderboard")],Ae);let Te=class extends pe{constructor(e){super(Be(e,(e=>e.prefix.toLowerCase())))}getCheermoteDisplayInfo(e,t,r){e=e.toLowerCase();const{background:n,state:s,scale:i}=r,{tiers:a}=this[he][e],o=a.sort(((e,t)=>t.min_bits-e.min_bits)).find((e=>e.min_bits<=t));if(!o)throw new ye(`Cheermote "${e}" does not have an applicable tier for ${t} bits`);return{url:o.images[n][s][i],color:o.color}}getPossibleNames(){return Object.keys(this[he])}};Te=o([te("api","HelixCheermoteList")],Te);let Ee=class extends xe{async getLeaderboard(t,r={}){const n=await this._client.callApi({type:"helix",url:"bits/leaderboard",userId:e(t),scopes:["bits:read"],query:be(r)});return new Ae(n,this._client)}async getCheermotes(t){const r=await this._client.callApi({type:"helix",url:"bits/cheermotes",userId:b(t,e),query:b(t,fe)});return new Te(r.data)}};function Ue(e){var t;return{game_id:e.gameId,broadcaster_language:e.language,title:e.title,delay:null===(t=e.delay)||void 0===t?void 0:t.toString(),tags:e.tags,content_classification_labels:e.contentClassificationLabels,is_branded_content:e.isBrandedContent}}function De(t,r){return{broadcaster_id:e(t),length:r}}function qe(t,r){return{broadcaster_id:e(t),user_id:e(r)}}function Pe(t,r){return{broadcaster_id:e(t),user_id:b(r,e)}}function Re(t,r){return{broadcaster_id:b(r,e),user_id:e(t)}}function Oe(e,t){return{[e]:t}}function ke(t){return{user_id:e(t)}}function Ne(e,t){return{broadcaster_id:e,moderator_id:t}}function je(t,r){return{broadcaster_id:e(t),id:r}}function Fe(t,r){return{broadcaster_id:e(t),user_id:r.map(e)}}Ee=o([te("api","HelixBitsApi")],Ee);let He=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].user_id}get name(){return this[he].user_login}get displayName(){return this[he].user_name}async getUser(){return Ce(await this._client.users.getUserById(this[he].user_id))}};o([ve(!1)],He.prototype,"_client",void 0),He=o([te("api","HelixUserRelation","id")],He);class Me{constructor(e,t,r,n,s,i=100){this._callOptions=e,this._queryParamName=t,this._matchKey=r,this._mapper=s,this._limitPerRequest=i,this._requestedIds=[],this._requestResolversById=new Map,this._waitTimer=null,this._client=n,this._delay=n._batchDelay}async request(e){const{promise:t,resolve:r,reject:n}=ce();return this._requestedIds.includes(e)||this._requestedIds.push(e),this._requestResolversById.has(e)?this._requestResolversById.get(e).push({resolve:r,reject:n}):this._requestResolversById.set(e,[{resolve:r,reject:n}]),this._waitTimer&&(clearTimeout(this._waitTimer),this._waitTimer=null),this._requestedIds.length>=this._limitPerRequest?this._handleBatch(this._requestedIds.splice(0,this._limitPerRequest)):this._waitTimer=setTimeout((()=>{this._handleBatch(this._requestedIds.splice(0,this._limitPerRequest))}),this._delay),await t}async _handleBatch(e){var t;try{const{data:r}=await this._doRequest(e),n=Be(r,this._matchKey);for(const r of e){for(const e of null!==(t=this._requestResolversById.get(r))&&void 0!==t?t:[])Object.prototype.hasOwnProperty.call(n,r)?e.resolve(this._mapper(n[r])):e.resolve(null);this._requestResolversById.delete(r)}}catch(t){await Promise.all(e.map((async e=>{var t,r;try{const r=await this._doRequest([e]);for(const n of null!==(t=this._requestResolversById.get(e))&&void 0!==t?t:[])n.resolve(r.data.length?this._mapper(r.data[0]):null)}catch(t){for(const n of null!==(r=this._requestResolversById.get(e))&&void 0!==r?r:[])n.reject(t)}this._requestResolversById.delete(e)})))}}async _doRequest(e){return await this._client.callApi({type:"helix",...this._callOptions,query:{...this._callOptions.query,[this._queryParamName]:e}})}}var Le;o([ve(!1)],Me.prototype,"_client",void 0),Object.prototype.hasOwnProperty.call(Symbol,"asyncIterator")||(Symbol.asyncIterator=null!==(Le=Symbol.asyncIterator)&&void 0!==Le?Le:Symbol.for("Symbol.asyncIterator"));let Ge=class{constructor(e,t,r,n=100){this._callOptions=e,this._mapper=r,this._limitPerPage=n,this._isFinished=!1,this._client=t}get current(){var e;return null===(e=this._currentData)||void 0===e?void 0:e.data}async getNext(){var e;if(this._isFinished)return[];const t=await this._fetchData();return(null===(e=t.data)||void 0===e?void 0:e.length)?this._processResult(t):(this._isFinished=!0,[])}async getAll(){this.reset();const e=[];do{const t=await this.getNext();if(!t.length)break;e.push(...t)}while(this._currentCursor);return this.reset(),e}get currentCursor(){return this._currentCursor}reset(){this._currentCursor=void 0,this._isFinished=!1,this._currentData=void 0}async*[Symbol.asyncIterator](){for(this.reset();;){const e=await this.getNext();if(!e.length)break;yield*e[Symbol.iterator]()}}async _fetchData(e={}){return await this._client.callApi({type:"helix",...this._callOptions,...e,query:{...this._callOptions.query,after:this._currentCursor,first:this._limitPerPage.toString(),...e.query}})}_processResult(e){var t;return this._currentCursor="string"==typeof e.pagination?e.pagination:null===(t=e.pagination)||void 0===t?void 0:t.cursor,void 0===this._currentCursor&&(this._isFinished=!0),this._currentData=e,e.data.reduce(((e,t)=>{const r=this._mapper(t);return Array.isArray(r)?[...e,...r]:[...e,r]}),[])}};o([ve(!1)],Ge.prototype,"_client",void 0),Ge=o([te("api","HelixPaginatedRequest")],Ge);let $e=class extends Ge{async getTotalCount(){var e;return(null!==(e=this._currentData)&&void 0!==e?e:await this._fetchData({query:{after:void 0}})).total}};function We(e,t,r){var n;let s;return{get data(){var n,i;return null!=s?s:s=null!==(i=null===(n=e.data)||void 0===n?void 0:n.map((e=>new t(e,r))))&&void 0!==i?i:[]},cursor:"string"==typeof e.pagination?e.pagination:null===(n=e.pagination)||void 0===n?void 0:n.cursor}}function Ve(e,t,r){let n;return{get data(){var s,i;return null!=n?n:n=null!==(i=null===(s=e.data)||void 0===s?void 0:s.map((e=>new t(e,r))))&&void 0!==i?i:[]},cursor:e.pagination.cursor,total:e.total}}function ze({after:e,before:t,limit:r}={}){return{after:e,before:t,first:null==r?void 0:r.toString()}}$e=o([te("api","HelixPaginatedRequestWithTotal")],$e);let Qe=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].broadcaster_id}get name(){return this[he].broadcaster_login}get displayName(){return this[he].broadcaster_name}async getBroadcaster(){return Ce(await this._client.users.getUserById(this[he].broadcaster_id))}get language(){return this[he].broadcaster_language}get gameId(){return this[he].game_id}get gameName(){return this[he].game_name}async getGame(){return this[he].game_id?Ce(await this._client.games.getGameById(this[he].game_id)):null}get title(){return this[he].title}get delay(){return this[he].delay}get tags(){return this[he].tags}get contentClassificationLabels(){return this[he].content_classification_labels}get isBrandedContent(){return this[he].is_branded_content}};o([ve(!1)],Qe.prototype,"_client",void 0),Qe=o([te("api","HelixChannel","id")],Qe);let Ke=class extends pe{constructor(e,t){super(e),this._client=t}get userId(){return this[he].user_id}get userDisplayName(){return this[he].user_name}async getUser(){return Ce(await this._client.users.getUserById(this[he].user_id))}get creationDate(){return new Date(this[he].created_at)}};o([ve(!1)],Ke.prototype,"_client",void 0),Ke=o([te("api","HelixChannelEditor","userId")],Ke);let Je=class extends pe{constructor(e,t){super(e),this._client=t}get userId(){return this[he].user_id}get userName(){return this[he].user_login}get userDisplayName(){return this[he].user_name}async getUser(){return Ce(await this._client.users.getUserById(this[he].user_id))}get followDate(){return new Date(this[he].followed_at)}};o([ve(!1)],Je.prototype,"_client",void 0),Je=o([te("api","HelixChannelFollower","userId")],Je);let Ye=class extends pe{constructor(e,t){super(e),this._client=t}get broadcasterId(){return this[he].broadcaster_id}get broadcasterName(){return this[he].broadcaster_login}get broadcasterDisplayName(){return this[he].broadcaster_name}async getBroadcaster(){return Ce(await this._client.users.getUserById(this[he].broadcaster_id))}get followDate(){return new Date(this[he].followed_at)}};o([ve(!1)],Ye.prototype,"_client",void 0),Ye=o([te("api","HelixFollowedChannel","broadcasterId")],Ye);let Xe=class extends pe{get snoozeCount(){return this[he].snooze_count}get snoozeRefreshDate(){return this[he].snooze_refresh_at?new Date(1e3*this[he].snooze_refresh_at):null}get nextAdDate(){return this[he].next_ad_at?new Date(1e3*this[he].next_ad_at):null}get duration(){return this[he].duration}get lastAdDate(){return this[he].last_ad_at?new Date(1e3*this[he].last_ad_at):null}get prerollFreeTime(){return this[he].preroll_free_time}};Xe=o([te("api","HelixAdSchedule")],Xe);let Ze=class extends pe{get snoozeCount(){return this[he].snooze_count}get snoozeRefreshDate(){return new Date(1e3*this[he].snooze_refresh_at)}get nextAdDate(){return new Date(1e3*this[he].next_ad_at)}};Ze=o([te("api","HelixSnoozeNextAdResult")],Ze);let et=class extends xe{constructor(){super(...arguments),this._getChannelByIdBatcher=new Me({url:"channels"},"broadcaster_id","broadcaster_id",this._client,(e=>new Qe(e,this._client)))}async getChannelInfoById(t){const r=e(t);return f((await this._client.callApi({type:"helix",url:"channels",userId:r,query:fe(r)})).data[0],(e=>new Qe(e,this._client)))}async getChannelInfoByIdBatched(t){return await this._getChannelByIdBatcher.request(e(t))}async getChannelInfoByIds(t){const r=t.map(e);return(await this._client.callApi({type:"helix",url:"channels",query:Oe("broadcaster_id",r)})).data.map((e=>new Qe(e,this._client)))}async updateChannelInfo(t,r){await this._client.callApi({type:"helix",url:"channels",method:"PATCH",userId:e(t),scopes:["channel:manage:broadcast"],query:fe(t),jsonBody:Ue(r)})}async startChannelCommercial(t,r){await this._client.callApi({type:"helix",url:"channels/commercial",method:"POST",userId:e(t),scopes:["channel:edit:commercial"],jsonBody:De(t,r)})}async getChannelEditors(t){return(await this._client.callApi({type:"helix",url:"channels/editors",userId:e(t),scopes:["channel:read:editors"],query:fe(t)})).data.map((e=>new Ke(e,this._client)))}async getVips(t,r){return We(await this._client.callApi({type:"helix",url:"channels/vips",userId:e(t),scopes:["channel:read:vips","channel:manage:vips"],query:{...fe(t),...ze(r)}}),He,this._client)}getVipsPaginated(t){return new Ge({url:"channels/vips",userId:e(t),scopes:["channel:read:vips","channel:manage:vips"],query:fe(t)},this._client,(e=>new He(e,this._client)))}async checkVipForUsers(t,r){return(await this._client.callApi({type:"helix",url:"channels/vips",userId:e(t),scopes:["channel:read:vips","channel:manage:vips"],query:Fe(t,r)})).data.map((e=>new He(e,this._client)))}async checkVipForUser(t,r){const n=e(r);return(await this.checkVipForUsers(t,[n])).some((e=>e.id===n))}async addVip(t,r){await this._client.callApi({type:"helix",url:"channels/vips",method:"POST",userId:e(t),scopes:["channel:manage:vips"],query:qe(t,r)})}async removeVip(t,r){await this._client.callApi({type:"helix",url:"channels/vips",method:"DELETE",userId:e(t),scopes:["channel:manage:vips"],query:qe(t,r)})}async getChannelFollowerCount(t){return(await this._client.callApi({type:"helix",url:"channels/followers",method:"GET",userId:e(t),query:{...Pe(t),...ze({limit:1})}})).total}async getChannelFollowers(t,r,n){return Ve(await this._client.callApi({type:"helix",url:"channels/followers",method:"GET",userId:e(t),canOverrideScopedUserContext:!0,scopes:["moderator:read:followers"],query:{...Pe(t,r),...ze(n)}}),Je,this._client)}getChannelFollowersPaginated(t){return new $e({url:"channels/followers",method:"GET",userId:e(t),canOverrideScopedUserContext:!0,scopes:["moderator:read:followers"],query:Pe(t)},this._client,(e=>new Je(e,this._client)))}async getFollowedChannels(t,r,n){return Ve(await this._client.callApi({type:"helix",url:"channels/followed",method:"GET",userId:e(t),scopes:["user:read:follows"],query:{...Re(t,r),...ze(n)}}),Ye,this._client)}getFollowedChannelsPaginated(t,r){return new $e({url:"channels/followed",method:"GET",userId:e(t),scopes:["user:read:follows"],query:Re(t,r)},this._client,(e=>new Ye(e,this._client)))}async getAdSchedule(t){const r=await this._client.callApi({type:"helix",url:"channels/ads",method:"GET",userId:e(t),scopes:["channel:read:ads"],query:fe(t)});return new Xe(r.data[0])}async snoozeNextAd(t){const r=await this._client.callApi({type:"helix",url:"channels/ads/schedule/snooze",method:"POST",userId:e(t),scopes:["channel:manage:ads"],query:fe(t)});return new Ze(r.data[0])}};function tt(t,r){return{broadcaster_id:e(t),only_manageable_rewards:null==r?void 0:r.toString()}}function rt(t,r){return{broadcaster_id:e(t),id:r}}function nt(e){var t,r,n;const s={title:e.title,cost:e.cost,prompt:e.prompt,background_color:e.backgroundColor,is_enabled:e.isEnabled,is_user_input_required:e.userInputRequired,should_redemptions_skip_request_queue:e.autoFulfill};return void 0!==e.maxRedemptionsPerStream&&(s.is_max_per_stream_enabled=!!e.maxRedemptionsPerStream,s.max_per_stream=null!==(t=e.maxRedemptionsPerStream)&&void 0!==t?t:0),void 0!==e.maxRedemptionsPerUserPerStream&&(s.is_max_per_user_per_stream_enabled=!!e.maxRedemptionsPerUserPerStream,s.max_per_user_per_stream=null!==(r=e.maxRedemptionsPerUserPerStream)&&void 0!==r?r:0),void 0!==e.globalCooldown&&(s.is_global_cooldown_enabled=!!e.globalCooldown,s.global_cooldown_seconds=null!==(n=e.globalCooldown)&&void 0!==n?n:0),"isPaused"in e&&(s.is_paused=e.isPaused),s}function st(t,r,n){return{broadcaster_id:e(t),reward_id:r,id:n}}function it(t,r,n,s){return{broadcaster_id:e(t),reward_id:r,status:n,sort:s.newestFirst?"NEWEST":"OLDEST"}}o([ve(!1)],et.prototype,"_getChannelByIdBatcher",void 0),et=o([te("api","HelixChannelApi")],et);let at=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].id}get broadcasterId(){return this[he].broadcaster_id}get broadcasterName(){return this[he].broadcaster_login}get broadcasterDisplayName(){return this[he].broadcaster_name}async getBroadcaster(){return Ce(await this._client.users.getUserById(this[he].broadcaster_id))}getImageUrl(e){var t,r;const n=`url_${e}x`;return null!==(r=null===(t=this[he].image)||void 0===t?void 0:t[n])&&void 0!==r?r:this[he].default_image[n]}get backgroundColor(){return this[he].background_color}get isEnabled(){return this[he].is_enabled}get cost(){return this[he].cost}get title(){return this[he].title}get prompt(){return this[he].prompt}get userInputRequired(){return this[he].is_user_input_required}get maxRedemptionsPerStream(){return this[he].max_per_stream_setting.is_enabled?this[he].max_per_stream_setting.max_per_stream:null}get maxRedemptionsPerUserPerStream(){return this[he].max_per_user_per_stream_setting.is_enabled?this[he].max_per_user_per_stream_setting.max_per_user_per_stream:null}get globalCooldown(){return this[he].global_cooldown_setting.is_enabled?this[he].global_cooldown_setting.global_cooldown_seconds:null}get isPaused(){return this[he].is_paused}get isInStock(){return this[he].is_in_stock}get redemptionsThisStream(){return this[he].redemptions_redeemed_current_stream}get autoFulfill(){return this[he].should_redemptions_skip_request_queue}get cooldownExpiryDate(){return this[he].cooldown_expires_at?new Date(this[he].cooldown_expires_at):null}};o([ve(!1)],at.prototype,"_client",void 0),at=o([te("api","HelixCustomReward","id")],at);let ot=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].id}get broadcasterId(){return this[he].broadcaster_id}get broadcasterName(){return this[he].broadcaster_login}get broadcasterDisplayName(){return this[he].broadcaster_name}async getBroadcaster(){return Ce(await this._client.users.getUserById(this[he].broadcaster_id))}get userId(){return this[he].user_id}get userName(){return this[he].user_login}get userDisplayName(){return this[he].user_name}async getUser(){return Ce(await this._client.users.getUserById(this[he].user_id))}get userInput(){return this[he].user_input}get isFulfilled(){return"FULFILLED"===this[he].status}get isCanceled(){return"CANCELED"===this[he].status}get redemptionDate(){return new Date(this[he].redeemed_at)}get rewardId(){return this[he].reward.id}get rewardTitle(){return this[he].reward.title}get rewardPrompt(){return this[he].reward.prompt}get rewardCost(){return this[he].reward.cost}async getReward(){return Ce(await this._client.channelPoints.getCustomRewardById(this[he].broadcaster_id,this[he].reward.id))}async updateStatus(e){return(await this._client.channelPoints.updateRedemptionStatusByIds(this[he].broadcaster_id,this[he].reward.id,[this[he].id],e))[0]}};o([ve(!1)],ot.prototype,"_client",void 0),ot=o([te("api","HelixCustomRewardRedemption","id")],ot);let lt=class extends xe{async getCustomRewards(t,r){return(await this._client.callApi({type:"helix",url:"channel_points/custom_rewards",userId:e(t),scopes:["channel:read:redemptions","channel:manage:redemptions"],query:tt(t,r)})).data.map((e=>new at(e,this._client)))}async getCustomRewardsByIds(t,r){return r.length?(await this._client.callApi({type:"helix",url:"channel_points/custom_rewards",userId:e(t),scopes:["channel:read:redemptions","channel:manage:redemptions"],query:je(t,r)})).data.map((e=>new at(e,this._client))):[]}async getCustomRewardById(e,t){const r=await this.getCustomRewardsByIds(e,[t]);return r.length?r[0]:null}async createCustomReward(t,r){const n=await this._client.callApi({type:"helix",url:"channel_points/custom_rewards",method:"POST",userId:e(t),scopes:["channel:manage:redemptions"],query:fe(t),jsonBody:nt(r)});return new at(n.data[0],this._client)}async updateCustomReward(t,r,n){const s=await this._client.callApi({type:"helix",url:"channel_points/custom_rewards",method:"PATCH",userId:e(t),scopes:["channel:manage:redemptions"],query:rt(t,r),jsonBody:nt(n)});return new at(s.data[0],this._client)}async deleteCustomReward(t,r){await this._client.callApi({type:"helix",url:"channel_points/custom_rewards",method:"DELETE",userId:e(t),scopes:["channel:manage:redemptions"],query:rt(t,r)})}async getRedemptionsByIds(t,r,n){return n.length?(await this._client.callApi({type:"helix",url:"channel_points/custom_rewards/redemptions",userId:e(t),scopes:["channel:read:redemptions","channel:manage:redemptions"],query:st(t,r,n)})).data.map((e=>new ot(e,this._client))):[]}async getRedemptionById(e,t,r){const n=await this.getRedemptionsByIds(e,t,[r]);return n.length?n[0]:null}async getRedemptionsForBroadcaster(t,r,n,s){return We(await this._client.callApi({type:"helix",url:"channel_points/custom_rewards/redemptions",userId:e(t),scopes:["channel:read:redemptions","channel:manage:redemptions"],query:{...it(t,r,n,s),...ze(s)}}),ot,this._client)}getRedemptionsForBroadcasterPaginated(t,r,n,s){return new Ge({url:"channel_points/custom_rewards/redemptions",userId:e(t),scopes:["channel:read:redemptions","channel:manage:redemptions"],query:it(t,r,n,s)},this._client,(e=>new ot(e,this._client)),50)}async updateRedemptionStatusByIds(t,r,n,s){return n.length?(await this._client.callApi({type:"helix",url:"channel_points/custom_rewards/redemptions",method:"PATCH",userId:e(t),scopes:["channel:manage:redemptions"],query:st(t,r,n),jsonBody:{status:s}})).data.map((e=>new ot(e,this._client))):[]}};lt=o([te("api","HelixChannelPointsApi")],lt);let ct=class extends pe{get value(){return this[he].value}get decimalPlaces(){return this[he].decimal_places}get localizedValue(){return this.value/10**this.decimalPlaces}get currency(){return this[he].currency}};ct=o([te("api","HelixCharityCampaignAmount")],ct);let ut=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].id}get broadcasterId(){return this[he].broadcaster_id}get broadcasterName(){return this[he].broadcaster_login}get broadcasterDisplayName(){return this[he].broadcaster_name}async getBroadcaster(){return Ce(await this._client.users.getUserById(this[he].broadcaster_id))}get charityName(){return this[he].charity_name}get charityDescription(){return this[he].charity_description}get charityLogo(){return this[he].charity_logo}get charityWebsite(){return this[he].charity_website}get currentAmount(){return new ct(this[he].current_amount)}get targetAmount(){return new ct(this[he].target_amount)}};o([ve(!1)],ut.prototype,"_client",void 0),ut=o([te("api","HelixCharityCampaign","id")],ut);let dt=class extends pe{constructor(e,t){super(e),this._client=t}get campaignId(){return this[he].campaign_id}get donorId(){return this[he].user_id}get donorName(){return this[he].user_login}get donorDisplayName(){return this[he].user_name}async getDonor(){return Ce(await this._client.users.getUserById(this[he].user_id))}get amount(){return new ct(this[he].amount)}};o([ve(!1)],dt.prototype,"_client",void 0),dt=o([te("api","HelixCharityCampaignDonation")],dt);let ht=class extends xe{async getCharityCampaign(t){const r=await this._client.callApi({type:"helix",url:"charity/campaigns",method:"GET",userId:e(t),scopes:["channel:read:charity"],query:fe(t)});return new ut(r.data[0],this._client)}async getCharityCampaignDonations(t,r){return We(await this._client.callApi({type:"helix",url:"charity/donations",userId:e(t),scopes:["channel:read:charity"],query:{...fe(t),...ze(r)}}),dt,this._client)}};function pt(e){return{slow_mode:e.slowModeEnabled,slow_mode_wait_time:e.slowModeDelay,follower_mode:e.followerOnlyModeEnabled,follower_mode_duration:e.followerOnlyModeDelay,subscriber_mode:e.subscriberOnlyModeEnabled,emote_mode:e.emoteOnlyModeEnabled,unique_chat_mode:e.uniqueChatModeEnabled,non_moderator_chat_delay:e.nonModeratorChatDelayEnabled,non_moderator_chat_delay_duration:e.nonModeratorChatDelay}}function gt(t,r){return{user_id:e(t),color:r}}function _t(t,r,n){return{from_broadcaster_id:e(t),to_broadcaster_id:e(r),moderator_id:n}}function mt(e,t){return{broadcaster_id:e,sender_id:t}}function yt(e,t){return{message:e,reply_parent_message_id:null==t?void 0:t.replyParentMessageId}}ht=o([te("api","HelixCharityApi")],ht);class wt extends pe{get id(){return this[he].id}get name(){return this[he].name}get formats(){return this[he].format}get scales(){return this[he].scale}get themeModes(){return this[he].theme_mode}getStaticImageUrl(e="1.0",t="light"){return this[he].format.includes("static")&&this[he].scale.includes(e)?this.getFormattedImageUrl(e,"static",t):null}getAnimatedImageUrl(e="1.0",t="light"){return this[he].format.includes("animated")&&this[he].scale.includes(e)?this.getFormattedImageUrl(e,"animated",t):null}getFormattedImageUrl(e="1.0",t="static",r="light"){return`https://static-cdn.jtvnw.net/emoticons/v2/${this[he].id}/${t}/${r}/${e}`}}let ft=class extends wt{getImageUrl(e){return this[he].images[`url_${e}x`]}};ft=o([te("api","HelixEmote","id")],ft);let bt=class extends ft{constructor(e,t){super(e),this._client=t}get tier(){return this[he].tier||null}get type(){return this[he].emote_type}get emoteSetId(){return this[he].emote_set_id}async getAllEmotesFromSet(){return await this._client.chat.getEmotesFromSets([this[he].emote_set_id])}};o([ve(!1)],bt.prototype,"_client",void 0),bt=o([te("api","HelixChannelEmote","id")],bt);let vt=class extends pe{get id(){return this[he].id}getImageUrl(e){return this[he][`image_url_${e}x`]}get title(){return this[he].title}get description(){return this[he].description}get clickAction(){return this[he].click_action}get clickUrl(){return this[he].click_url}};vt=o([te("api","HelixChatBadgeVersion","id")],vt);let xt=class extends pe{get id(){return this[he].set_id}get versions(){return this[he].versions.map((e=>new vt(e)))}getVersion(e){var t;return null!==(t=this.versions.find((t=>t.id===e)))&&void 0!==t?t:null}};o([ae()],xt.prototype,"versions",null),xt=o([le,te("api","HelixChatBadgeSet","id")],xt);let It=class extends pe{constructor(e,t){super(e),this._client=t}get userId(){return this[he].user_id}get userName(){return this[he].user_login}get userDisplayName(){return this[he].user_name}async getUser(){return Ce(await this._client.users.getUserById(this[he].user_id))}};o([ve(!1)],It.prototype,"_client",void 0),It=o([te("api","HelixChatChatter")],It);let Ct=class extends pe{get broadcasterId(){return this[he].broadcaster_id}get slowModeEnabled(){return this[he].slow_mode}get slowModeDelay(){return this[he].slow_mode_wait_time}get followerOnlyModeEnabled(){return this[he].follower_mode}get followerOnlyModeDelay(){return this[he].follower_mode_duration}get subscriberOnlyModeEnabled(){return this[he].subscriber_mode}get emoteOnlyModeEnabled(){return this[he].emote_mode}get uniqueChatModeEnabled(){return this[he].unique_chat_mode}};Ct=o([te("api","HelixChatSettings","broadcasterId")],Ct);let St=class extends ft{constructor(e,t){super(e),this._client=t}get type(){return this[he].emote_type}get emoteSetId(){return this[he].emote_set_id}get ownerId(){switch(this[he].owner_id){case"0":case"twitch":return null;default:return this[he].owner_id}}async getOwner(){switch(this[he].owner_id){case"0":case"twitch":return null;default:return await this._client.users.getUserById(this[he].owner_id)}}};o([ve(!1)],St.prototype,"_client",void 0),St=o([te("api","HelixEmoteFromSet","id")],St);let At=class extends wt{constructor(e,t){super(e),this._client=t}get type(){return this[he].emote_type}get emoteSetId(){return this[he].emote_set_id||null}get ownerId(){return this[he].owner_id||null}async getAllEmotesFromSet(){return this[he].emote_set_id?await this._client.chat.getEmotesFromSets([this[he].emote_set_id]):null}async getOwner(){return this[he].owner_id?await this._client.users.getUserById(this[he].owner_id):null}};o([ve(!1)],At.prototype,"_client",void 0),At=o([te("api","HelixUserEmote","id")],At);let Bt=class extends Ct{get nonModeratorChatDelayEnabled(){return this[he].non_moderator_chat_delay}get nonModeratorChatDelay(){return this[he].non_moderator_chat_delay_duration}};Bt=o([te("api","HelixPrivilegedChatSettings","broadcasterId")],Bt);let Tt=class extends pe{get id(){return this[he].message_id}get isSent(){return this[he].is_sent}get dropReasonCode(){var e;return null===(e=this[he].drop_reason)||void 0===e?void 0:e.code}get dropReasonMessage(){var e;return null===(e=this[he].drop_reason)||void 0===e?void 0:e.message}};Tt=o([te("api","HelixSentChatMessage","id")],Tt);let Et=class extends xe{async getChatters(t,r){const n=e(t);return Ve(await this._client.callApi({type:"helix",url:"chat/chatters",userId:n,canOverrideScopedUserContext:!0,scopes:["moderator:read:chatters"],query:{...this._createModeratorActionQuery(n),...ze(r)}}),It,this._client)}getChattersPaginated(t){const r=e(t);return new $e({url:"chat/chatters",userId:r,canOverrideScopedUserContext:!0,scopes:["moderator:read:chatters"],query:this._createModeratorActionQuery(r)},this._client,(e=>new It(e,this._client)),1e3)}async getGlobalBadges(){return(await this._client.callApi({type:"helix",url:"chat/badges/global"})).data.map((e=>new xt(e)))}async getChannelBadges(t){return(await this._client.callApi({type:"helix",url:"chat/badges",userId:e(t),query:fe(t)})).data.map((e=>new xt(e)))}async getGlobalEmotes(){return(await this._client.callApi({type:"helix",url:"chat/emotes/global"})).data.map((e=>new ft(e)))}async getChannelEmotes(t){return(await this._client.callApi({type:"helix",url:"chat/emotes",userId:e(t),query:fe(t)})).data.map((e=>new bt(e,this._client)))}async getEmotesFromSets(e){return(await this._client.callApi({type:"helix",url:"chat/emotes/set",query:Oe("emote_set_id",e)})).data.map((e=>new St(e,this._client)))}async getUserEmotes(t,r){const n=e(t);return We(await this._client.callApi({type:"helix",url:"chat/emotes/user",userId:e(t),scopes:["user:read:emotes"],query:{...Oe("user_id",n),...Oe("broadcasterId",(null==r?void 0:r.broadcaster)?e(r.broadcaster):void 0),...ze(r)}}),At,this._client)}getUserEmotesPaginated(t,r){const n=e(t);return new Ge({url:"chat/emotes/user",userId:n,scopes:["user:read:emotes"],query:{...Oe("user_id",n),...Oe("broadcasterId",r?e(r):void 0)}},this._client,(e=>new At(e,this._client)))}async getSettings(t){const r=await this._client.callApi({type:"helix",url:"chat/settings",userId:e(t),query:fe(t)});return new Ct(r.data[0])}async getSettingsPrivileged(t){const r=e(t),n=await this._client.callApi({type:"helix",url:"chat/settings",userId:r,canOverrideScopedUserContext:!0,scopes:["moderator:read:chat_settings"],query:this._createModeratorActionQuery(r)});return new Bt(n.data[0])}async updateSettings(t,r){const n=e(t),s=await this._client.callApi({type:"helix",url:"chat/settings",method:"PATCH",userId:n,canOverrideScopedUserContext:!0,scopes:["moderator:manage:chat_settings"],query:this._createModeratorActionQuery(n),jsonBody:pt(r)});return new Bt(s.data[0])}async sendChatMessage(t,r,n){const s=e(t),i=await this._client.callApi({type:"helix",url:"chat/messages",method:"POST",userId:s,canOverrideScopedUserContext:!0,scopes:["user:write:chat"],query:mt(s,this._getUserContextIdWithDefault(s)),jsonBody:yt(r,n)});return new Tt(i.data[0])}async sendChatMessageAsApp(t,r,n,s){const i=e(t),a=e(r),o=await this._client.callApi({type:"helix",url:"chat/messages",method:"POST",forceType:"app",query:mt(a,i),jsonBody:yt(n,s)});return new Tt(o.data[0])}async sendAnnouncement(t,r){const n=e(t);await this._client.callApi({type:"helix",url:"chat/announcements",method:"POST",userId:n,canOverrideScopedUserContext:!0,scopes:["moderator:manage:announcements"],query:this._createModeratorActionQuery(n),jsonBody:{message:r.message,color:r.color}})}async getColorsForUsers(t){const r=await this._client.callApi({type:"helix",url:"chat/color",query:Oe("user_id",t.map(e))});return new Map(r.data.map((e=>[e.user_id,e.color||null])))}async getColorForUser(t){const r=await this._client.callApi({type:"helix",url:"chat/color",userId:e(t),query:Oe("user_id",e(t))});if(r.data.length)return r.data[0].color||null}async setColorForUser(t,r){await this._client.callApi({type:"helix",url:"chat/color",method:"PUT",userId:e(t),scopes:["user:manage:chat_color"],query:gt(t,r)})}async shoutoutUser(t,r){const n=e(t);await this._client.callApi({type:"helix",url:"chat/shoutouts",method:"POST",userId:n,canOverrideScopedUserContext:!0,scopes:["moderator:manage:shoutouts"],query:_t(t,r,this._getUserContextIdWithDefault(n))})}_createModeratorActionQuery(e){return Ne(e,this._getUserContextIdWithDefault(e))}};function Ut(t,r){return{broadcaster_id:e(t),has_delay:r.toString()}}function Dt(e){const{filterType:t,ids:r,startDate:n,endDate:s,isFeatured:i}=e;return{[t]:r,started_at:n,ended_at:s,is_featured:null==i?void 0:i.toString()}}Et=o([te("api","HelixChatApi")],Et);let qt=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].id}get url(){return this[he].url}get embedUrl(){return this[he].embed_url}get broadcasterId(){return this[he].broadcaster_id}get broadcasterDisplayName(){return this[he].broadcaster_name}async getBroadcaster(){return Ce(await this._client.users.getUserById(this[he].broadcaster_id))}get creatorId(){return this[he].creator_id}get creatorDisplayName(){return this[he].creator_name}async getCreator(){return Ce(await this._client.users.getUserById(this[he].creator_id))}get videoId(){return this[he].video_id}async getVideo(){return Ce(await this._client.videos.getVideoById(this[he].video_id))}get gameId(){return this[he].game_id}async getGame(){return this[he].game_id?Ce(await this._client.games.getGameById(this[he].game_id)):null}get language(){return this[he].language}get title(){return this[he].title}get views(){return this[he].view_count}get creationDate(){return new Date(this[he].created_at)}get thumbnailUrl(){return this[he].thumbnail_url}get duration(){return this[he].duration}get vodOffset(){return this[he].vod_offset}get isFeatured(){return this[he].is_featured}};o([ve(!1)],qt.prototype,"_client",void 0),qt=o([te("api","HelixClip","id")],qt);let Pt=class extends xe{constructor(){super(...arguments),this._getClipByIdBatcher=new Me({url:"clips"},"id","id",this._client,(e=>new qt(e,this._client)))}async getClipsForBroadcaster(t,r={}){return await this._getClips({...r,filterType:"broadcaster_id",ids:e(t),userId:e(t)})}getClipsForBroadcasterPaginated(t,r={}){return this._getClipsPaginated({...r,filterType:"broadcaster_id",ids:e(t),userId:e(t)})}async getClipsForGame(e,t={}){return await this._getClips({...t,filterType:"game_id",ids:e})}getClipsForGamePaginated(e,t={}){return this._getClipsPaginated({...t,filterType:"game_id",ids:e})}async getClipsByIds(e){return(await this._getClips({filterType:"id",ids:e})).data}async getClipById(e){const t=await this.getClipsByIds([e]);return t.length?t[0]:null}async getClipByIdBatched(e){return await this._getClipByIdBatcher.request(e)}async createClip(t){const{channel:r,createAfterDelay:n=!1}=t;return(await this._client.callApi({type:"helix",url:"clips",method:"POST",userId:e(r),scopes:["clips:edit"],canOverrideScopedUserContext:!0,query:Ut(r,n)})).data[0].id}async _getClips(e){return e.ids.length?We(await this._client.callApi({type:"helix",url:"clips",userId:e.userId,query:{...Dt(e),...ze(e)}}),qt,this._client):{data:[]}}_getClipsPaginated(e){return new Ge({url:"clips",userId:e.userId,query:Dt(e)},this._client,(e=>new qt(e,this._client)))}};o([ve(!1)],Pt.prototype,"_getClipByIdBatcher",void 0),Pt=o([te("api","HelixClipApi")],Pt);class Rt extends pe{get id(){return this[he].id}get name(){return this[he].name}get description(){return this[he].description}}let Ot=class extends xe{async getAll(e){return(await this._client.callApi({url:"content_classification_labels",query:{locale:e}})).data.map((e=>new Rt(e)))}};function kt(t,r){return{user_id:r?b(t.user,e):void 0,game_id:t.gameId,fulfillment_status:t.fulfillmentStatus}}function Nt(e,t){return{fulfillment_status:t,entitlement_ids:e}}Ot=o([te("api","HelixContentClassificationLabelApi")],Ot);let jt=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].id}get rewardId(){return this[he].benefit_id}get grantDate(){return new Date(this[he].timestamp)}get userId(){return this[he].user_id}async getUser(){return Ce(await this._client.users.getUserById(this[he].user_id))}get gameId(){return this[he].game_id}async getGame(){return Ce(await this._client.games.getGameById(this[he].game_id))}get fulfillmentStatus(){return this[he].fulfillment_status}get updateDate(){return new Date(this[he].last_updated)}};o([ve(!1)],jt.prototype,"_client",void 0),jt=o([te("api","HelixDropsEntitlement")],jt);let Ft=class extends xe{constructor(){super(...arguments),this._getDropsEntitlementByIdBatcher=new Me({url:"entitlements/drops"},"id","id",this._client,(e=>new jt(e,this._client)))}async getDropsEntitlements(t,r=!1){return We(await this._client.callApi({type:"helix",url:"entitlements/drops",userId:b(t.user,e),forceType:t.user&&r?"app":void 0,query:{...kt(t,r),...ze(t)}}),jt,this._client)}getDropsEntitlementsPaginated(t,r=!1){return new Ge({url:"entitlements/drops",userId:b(t.user,e),forceType:t.user&&r?"app":void 0,query:kt(t,r)},this._client,(e=>new jt(e,this._client)))}async getDropsEntitlementsByIds(e){return(await this._client.callApi({type:"helix",url:"entitlements/drops",query:{id:e}})).data.map((e=>new jt(e,this._client)))}async getDropsEntitlementById(e){var t;return null!==(t=(await this.getDropsEntitlementsByIds([e]))[0])&&void 0!==t?t:null}async getDropsEntitlementByIdBatched(e){return await this._getDropsEntitlementByIdBatcher.request(e)}async updateDropsEntitlements(e,t){const r=await this._client.callApi({type:"helix",url:"entitlements/drops",method:"PATCH",jsonBody:Nt(e,t)});return new Map(r.data.flatMap((e=>e.ids.map((t=>[t,e.status])))))}};function Ht(t){return{broadcaster_user_id:e(t)}}function Mt(t,r){return{broadcaster_user_id:e(t),reward_id:r}}function Lt(e,t){return{broadcaster_user_id:e,moderator_user_id:t}}function Gt(e,t){return{broadcaster_user_id:e,user_id:t}}function $t(e,t){return{conduit_id:e,status:t}}function Wt(e,t){return{id:e,shard_count:t.toString()}}function Vt(e,t){return{conduit_id:e,shards:t}}o([ve(!1)],Ft.prototype,"_getDropsEntitlementByIdBatcher",void 0),Ft=o([te("api","HelixEntitlementApi")],Ft);let zt=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].id}get status(){return this[he].status}get type(){return this[he].type}get cost(){return this[he].cost}get condition(){return this[he].condition}get creationDate(){return new Date(this[he].created_at)}get transportMethod(){return this[he].transport.method}async unsubscribe(){await this._client.eventSub.deleteSubscription(this[he].id)}get _transport(){return this[he].transport}set _status(e){this[he].status=e}};o([ve(!1)],zt.prototype,"_client",void 0),zt=o([te("api","HelixEventSubSubscription","id")],zt);let Qt=class extends $e{constructor(e,t,r){super({url:"eventsub/subscriptions",userId:t,query:e},r,(e=>new zt(e,r)))}async getTotalCost(){var e;return(null!==(e=this._currentData)&&void 0!==e?e:await this._fetchData({query:{after:void 0}})).total_cost}async getMaxTotalCost(){var e;return(null!==(e=this._currentData)&&void 0!==e?e:await this._fetchData({query:{after:void 0}})).max_total_cost}};Qt=o([te("api","HelixPaginatedEventSubSubscriptionsRequest")],Qt);let Kt=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].id}get shardCount(){return this[he].shard_count}async update(e){return await this._client.eventSub.updateConduit(this[he].id,e)}async delete(){await this._client.eventSub.deleteConduit(this[he].id)}async getShards(){return await this._client.eventSub.getConduitShards(this[he].id)}};o([ve(!1)],Kt.prototype,"_client",void 0),Kt=o([te("api","HelixEventSubConduit")],Kt);let Jt=class extends pe{get id(){return this[he].id}get status(){return this[he].status}get transportMethod(){return this[he].transport.method}};Jt=o([te("api","HelixEventSubConduitShard")],Jt);let Yt=class extends xe{async getSubscriptions(e){const t=await this._client.callApi({type:"helix",url:"eventsub/subscriptions",query:ze(e)});return{...Ve(t,zt,this._client),totalCost:t.total_cost,maxTotalCost:t.max_total_cost}}getSubscriptionsPaginated(){return new Qt({},void 0,this._client)}async getSubscriptionsForStatus(e,t){const r=await this._client.callApi({type:"helix",url:"eventsub/subscriptions",query:{...ze(t),status:e}});return{...Ve(r,zt,this._client),totalCost:r.total_cost,maxTotalCost:r.max_total_cost}}getSubscriptionsForStatusPaginated(e){return new Qt({status:e},void 0,this._client)}async getSubscriptionsForType(e,t){const r=await this._client.callApi({type:"helix",url:"eventsub/subscriptions",query:{...ze(t),type:e}});return{...Ve(r,zt,this._client),totalCost:r.total_cost,maxTotalCost:r.max_total_cost}}getSubscriptionsForTypePaginated(e){return new Qt({type:e},void 0,this._client)}async getSubscriptionsForUser(t,r){const n=await this._client.callApi({type:"helix",url:"eventsub/subscriptions",userId:e(t),query:{...Oe("user_id",e(t)),...ze(r)}});return{...Ve(n,zt,this._client),totalCost:n.total_cost,maxTotalCost:n.max_total_cost}}getSubscriptionsForUserPaginated(t){const r=e(t);return new Qt(Oe("user_id",r),r,this._client)}async createSubscription(t,r,n,s,i,a,o,l){const c="webhook"===s.method||"conduit"===s.method,u=c?void 0:a;if(!c&&!i)throw new Error(`Transport ${s.method} can only handle subscriptions with user context`);const d={type:t,version:r,condition:n,transport:s};l&&(d.is_batching_enabled=!0);const h=await this._client.callApi({type:"helix",url:"eventsub/subscriptions",method:"POST",scopes:u,userId:b(i,e),canOverrideScopedUserContext:o,forceType:c?"app":"user",jsonBody:d});return new zt(h.data[0],this._client)}async deleteSubscription(e){await this._client.callApi({type:"helix",url:"eventsub/subscriptions",method:"DELETE",query:{id:e}})}async deleteAllSubscriptions(){await this._deleteSubscriptionsWithCondition()}async deleteBrokenSubscriptions(){await this._deleteSubscriptionsWithCondition((e=>"enabled"!==e.status&&"webhook_callback_verification_pending"!==e.status))}async subscribeToStreamOnlineEvents(e,t){return await this.createSubscription("stream.online","1",Ht(e),t,e)}async subscribeToStreamOfflineEvents(e,t){return await this.createSubscription("stream.offline","1",Ht(e),t,e)}async subscribeToChannelUpdateEvents(e,t){return await this.createSubscription("channel.update","1",Ht(e),t,e)}async subscribeToChannelFollowEvents(t,r){const n=e(t);return await this.createSubscription("channel.follow","2",Lt(n,this._getUserContextIdWithDefault(n)),r,n,["moderator:read:followers"],!0)}async subscribeToChannelSubscriptionEvents(e,t){return await this.createSubscription("channel.subscribe","1",Ht(e),t,e,["channel:read:subscriptions"])}async subscribeToChannelSubscriptionGiftEvents(e,t){return await this.createSubscription("channel.subscription.gift","1",Ht(e),t,e,["channel:read:subscriptions"])}async subscribeToChannelSubscriptionMessageEvents(e,t){return await this.createSubscription("channel.subscription.message","1",Ht(e),t,e,["channel:read:subscriptions"])}async subscribeToChannelSubscriptionEndEvents(e,t){return await this.createSubscription("channel.subscription.end","1",Ht(e),t,e,["channel:read:subscriptions"])}async subscribeToChannelCheerEvents(e,t){return await this.createSubscription("channel.cheer","1",Ht(e),t,e,["bits:read"])}async subscribeToChannelCharityCampaignStartEvents(e,t){return await this.createSubscription("channel.charity_campaign.start","1",Ht(e),t,e,["channel:read:charity"])}async subscribeToChannelCharityCampaignStopEvents(e,t){return await this.createSubscription("channel.charity_campaign.stop","1",Ht(e),t,e,["channel:read:charity"])}async subscribeToChannelCharityDonationEvents(e,t){return await this.createSubscription("channel.charity_campaign.donate","1",Ht(e),t,e,["channel:read:charity"])}async subscribeToChannelCharityCampaignProgressEvents(e,t){return await this.createSubscription("channel.charity_campaign.progress","1",Ht(e),t,e,["channel:read:charity"])}async subscribeToChannelBanEvents(e,t){return await this.createSubscription("channel.ban","1",Ht(e),t,e,["channel:moderate"])}async subscribeToChannelUnbanEvents(e,t){return await this.createSubscription("channel.unban","1",Ht(e),t,e,["channel:moderate"])}async subscribeToChannelShieldModeBeginEvents(t,r){const n=e(t);return await this.createSubscription("channel.shield_mode.begin","1",Lt(n,this._getUserContextIdWithDefault(n)),r,n,["moderator:read:shield_mode","moderator:manage:shield_mode"],!0)}async subscribeToChannelShieldModeEndEvents(t,r){const n=e(t);return await this.createSubscription("channel.shield_mode.end","1",Lt(n,this._getUserContextIdWithDefault(n)),r,n,["moderator:read:shield_mode","moderator:manage:shield_mode"],!0)}async subscribeToChannelModeratorAddEvents(e,t){return await this.createSubscription("channel.moderator.add","1",Ht(e),t,e,["moderation:read"])}async subscribeToChannelModeratorRemoveEvents(e,t){return await this.createSubscription("channel.moderator.remove","1",Ht(e),t,e,["moderation:read"])}async subscribeToChannelRaidEventsFrom(t,r){return await this.createSubscription("channel.raid","1",Oe("from_broadcaster_user_id",e(t)),r,t)}async subscribeToChannelRaidEventsTo(t,r){return await this.createSubscription("channel.raid","1",Oe("to_broadcaster_user_id",e(t)),r,t)}async subscribeToChannelRewardAddEvents(e,t){return await this.createSubscription("channel.channel_points_custom_reward.add","1",Ht(e),t,e,["channel:read:redemptions","channel:manage:redemptions"])}async subscribeToChannelRewardUpdateEvents(e,t){return await this.createSubscription("channel.channel_points_custom_reward.update","1",Ht(e),t,e,["channel:read:redemptions","channel:manage:redemptions"])}async subscribeToChannelRewardUpdateEventsForReward(e,t,r){return await this.createSubscription("channel.channel_points_custom_reward.update","1",Mt(e,t),r,e,["channel:read:redemptions","channel:manage:redemptions"])}async subscribeToChannelRewardRemoveEvents(e,t){return await this.createSubscription("channel.channel_points_custom_reward.remove","1",Ht(e),t,e,["channel:read:redemptions","channel:manage:redemptions"])}async subscribeToChannelRewardRemoveEventsForReward(e,t,r){return await this.createSubscription("channel.channel_points_custom_reward.remove","1",Mt(e,t),r,e,["channel:read:redemptions","channel:manage:redemptions"])}async subscribeToChannelRedemptionAddEvents(e,t){return await this.createSubscription("channel.channel_points_custom_reward_redemption.add","1",Ht(e),t,e,["channel:read:redemptions","channel:manage:redemptions"])}async subscribeToChannelRedemptionAddEventsForReward(e,t,r){return await this.createSubscription("channel.channel_points_custom_reward_redemption.add","1",Mt(e,t),r,e,["channel:read:redemptions","channel:manage:redemptions"])}async subscribeToChannelRedemptionUpdateEvents(e,t){return await this.createSubscription("channel.channel_points_custom_reward_redemption.update","1",Ht(e),t,e,["channel:read:redemptions","channel:manage:redemptions"])}async subscribeToChannelRedemptionUpdateEventsForReward(e,t,r){return await this.createSubscription("channel.channel_points_custom_reward_redemption.update","1",Mt(e,t),r,e,["channel:read:redemptions","channel:manage:redemptions"])}async subscribeToChannelAutomaticRewardRedemptionAddEvents(e,t){return await this.createSubscription("channel.channel_points_automatic_reward_redemption.add","1",Ht(e),t,e,["channel:read:redemptions","channel:manage:redemptions"])}async subscribeToChannelPollBeginEvents(e,t){return await this.createSubscription("channel.poll.begin","1",Ht(e),t,e,["channel:read:polls","channel:manage:polls"])}async subscribeToChannelPollProgressEvents(e,t){return await this.createSubscription("channel.poll.progress","1",Ht(e),t,e,["channel:read:polls","channel:manage:polls"])}async subscribeToChannelPollEndEvents(e,t){return await this.createSubscription("channel.poll.end","1",Ht(e),t,e,["channel:read:polls","channel:manage:polls"])}async subscribeToChannelPredictionBeginEvents(e,t){return await this.createSubscription("channel.prediction.begin","1",Ht(e),t,e,["channel:read:predictions","channel:manage:predictions"])}async subscribeToChannelPredictionProgressEvents(e,t){return await this.createSubscription("channel.prediction.progress","1",Ht(e),t,e,["channel:read:predictions","channel:manage:predictions"])}async subscribeToChannelPredictionLockEvents(e,t){return await this.createSubscription("channel.prediction.lock","1",Ht(e),t,e,["channel:read:predictions","channel:manage:predictions"])}async subscribeToChannelPredictionEndEvents(e,t){return await this.createSubscription("channel.prediction.end","1",Ht(e),t,e,["channel:read:predictions","channel:manage:predictions"])}async subscribeToChannelGoalBeginEvents(e,t){return await this.createSubscription("channel.goal.begin","1",Ht(e),t,e,["channel:read:goals"])}async subscribeToChannelGoalProgressEvents(e,t){return await this.createSubscription("channel.goal.progress","1",Ht(e),t,e,["channel:read:goals"])}async subscribeToChannelGoalEndEvents(e,t){return await this.createSubscription("channel.goal.end","1",Ht(e),t,e,["channel:read:goals"])}async subscribeToChannelHypeTrainBeginEvents(e,t){return await this.createSubscription("channel.hype_train.begin","1",Ht(e),t,e,["channel:read:hype_train"])}async subscribeToChannelHypeTrainProgressEvents(e,t){return await this.createSubscription("channel.hype_train.progress","1",Ht(e),t,e,["channel:read:hype_train"])}async subscribeToChannelHypeTrainEndEvents(e,t){return await this.createSubscription("channel.hype_train.end","1",Ht(e),t,e,["channel:read:hype_train"])}async subscribeToChannelShoutoutCreateEvents(t,r){const n=e(t);return await this.createSubscription("channel.shoutout.create","1",Lt(n,this._getUserContextIdWithDefault(n)),r,n,["moderator:read:shoutouts","moderator:manage:shoutouts"],!0)}async subscribeToChannelShoutoutReceiveEvents(t,r){const n=e(t);return await this.createSubscription("channel.shoutout.receive","1",Lt(n,this._getUserContextIdWithDefault(n)),r,n,["moderator:read:shoutouts","moderator:manage:shoutouts"],!0)}async subscribeToChannelAdBreakBeginEvents(e,t){return await this.createSubscription("channel.ad_break.begin","1",Ht(e),t,e,["channel:read:ads"])}async subscribeToChannelChatClearEvents(t,r){const n=e(t);return await this.createSubscription("channel.chat.clear","1",Gt(n,this._getUserContextIdWithDefault(n)),r,t,["user:read:chat"],!0)}async subscribeToChannelChatClearUserMessagesEvents(t,r){const n=e(t);return await this.createSubscription("channel.chat.clear_user_messages","1",Gt(n,this._getUserContextIdWithDefault(n)),r,t,["user:read:chat"],!0)}async subscribeToChannelChatMessageDeleteEvents(t,r){const n=e(t);return await this.createSubscription("channel.chat.message_delete","1",Gt(n,this._getUserContextIdWithDefault(n)),r,t,["user:read:chat"],!0)}async subscribeToChannelChatNotificationEvents(t,r){const n=e(t);return await this.createSubscription("channel.chat.notification","1",Gt(n,this._getUserContextIdWithDefault(n)),r,t,["user:read:chat"],!0)}async subscribeToChannelChatMessageEvents(t,r){const n=e(t);return await this.createSubscription("channel.chat.message","1",Gt(n,this._getUserContextIdWithDefault(n)),r,t,["user:read:chat"],!0)}async subscribeToChannelChatSettingsUpdateEvents(t,r){const n=e(t);return await this.createSubscription("channel.chat_settings.update","1",Gt(n,this._getUserContextIdWithDefault(n)),r,t,["user:read:chat"],!0)}async subscribeToChannelUnbanRequestCreateEvents(t,r){const n=e(t);return await this.createSubscription("channel.unban_request.create","1",Lt(n,this._getUserContextIdWithDefault(n)),r,t,["moderator:read:unban_requests","moderator:manage:unban_requests"],!0)}async subscribeToChannelUnbanRequestResolveEvents(t,r){const n=e(t);return await this.createSubscription("channel.unban_request.resolve","1",Lt(n,this._getUserContextIdWithDefault(n)),r,t,["moderator:read:unban_requests","moderator:manage:unban_requests"],!0)}async subscribeToChannelModerateEvents(t,r){const n=e(t);return await this.createSubscription("channel.moderate","2",Lt(n,this._getUserContextIdWithDefault(n)),r,t,[],!0)}async subscribeToChannelWarningAcknowledgeEvents(t,r){const n=e(t);return await this.createSubscription("channel.warning.acknowledge","1",Lt(n,this._getUserContextIdWithDefault(n)),r,t,["moderator:read:warnings","moderator:manage:warnings"],!0)}async subscribeToChannelWarningSendEvents(t,r){const n=e(t);return await this.createSubscription("channel.warning.send","1",Lt(n,this._getUserContextIdWithDefault(n)),r,t,["moderator:read:warnings","moderator:manage:warnings"],!0)}async subscribeToChannelVipAddEvents(e,t){return await this.createSubscription("channel.vip.add","1",Ht(e),t,e,["channel:read:vips","channel:manage:vips"])}async subscribeToChannelVipRemoveEvents(e,t){return await this.createSubscription("channel.vip.remove","1",Ht(e),t,e,["channel:read:vips","channel:manage:vips"])}async subscribeToExtensionBitsTransactionCreateEvents(e,t){return await this.createSubscription("extension.bits_transaction.create","1",Oe("extension_client_id",e),t)}async subscribeToUserAuthorizationGrantEvents(e,t){return await this.createSubscription("user.authorization.grant","1",Oe("client_id",e),t)}async subscribeToUserAuthorizationRevokeEvents(e,t){return await this.createSubscription("user.authorization.revoke","1",Oe("client_id",e),t)}async subscribeToUserUpdateEvents(t,r,n){return await this.createSubscription("user.update","1",Oe("user_id",e(t)),r,t,n?["user:read:email"]:void 0)}async subscribeToUserWhisperMessageEvents(t,r){return await this.createSubscription("user.whisper.message","1",Oe("user_id",e(t)),r,t,["user:read:whispers","user:manage:whispers"])}async subscribeToDropEntitlementGrantEvents(e,t){return await this.createSubscription("drop.entitlement.grant","1",function(e){return{organization_id:e.organizationId,category_id:e.categoryId,campaign_id:e.campaignId}}(e),t,void 0,void 0,!1,!0)}async subscribeToAutoModMessageHoldEvents(t,r){const n=e(t);return await this.createSubscription("automod.message.hold","1",Lt(n,this._getUserContextIdWithDefault(n)),r,t,["moderator:manage:automod"],!0)}async subscribeToAutoModMessageUpdateEvents(t,r){const n=e(t);return await this.createSubscription("automod.message.update","1",Lt(n,this._getUserContextIdWithDefault(n)),r,t,["moderator:manage:automod"],!0)}async subscribeToAutoModSettingsUpdateEvents(t,r){const n=e(t);return await this.createSubscription("automod.settings.update","1",Lt(n,this._getUserContextIdWithDefault(n)),r,t,["moderator:read:automod_settings"],!0)}async subscribeToAutoModTermsUpdateEvents(t,r){const n=e(t);return await this.createSubscription("automod.terms.update","1",Lt(n,this._getUserContextIdWithDefault(n)),r,t,["moderator:manage:automod"],!0)}async subscribeToChannelChatUserMessageHoldEvents(t,r){const n=e(t);return await this.createSubscription("channel.chat.user_message_hold","1",Gt(n,this._getUserContextIdWithDefault(n)),r,t,["user:read:chat"],!0)}async subscribeToChannelChatUserMessageUpdateEvents(t,r){const n=e(t);return await this.createSubscription("channel.chat.user_message_update","1",Gt(n,this._getUserContextIdWithDefault(n)),r,t,["user:read:chat"],!0)}async subscribeToChannelSuspiciousUserUpdateEvents(t,r){const n=e(t);return await this.createSubscription("channel.suspicious_user.update","1",Lt(n,this._getUserContextIdWithDefault(n)),r,t,["moderator:read:suspicious_users"],!0)}async subscribeToChannelSuspiciousUserMessageEvents(t,r){const n=e(t);return await this.createSubscription("channel.suspicious_user.message","1",Lt(n,this._getUserContextIdWithDefault(n)),r,t,["moderator:read:suspicious_users"],!0)}async getConduits(){return(await this._client.callApi({type:"helix",url:"eventsub/conduits"})).data.map((e=>new Kt(e,this._client)))}async createConduit(e){const t=await this._client.callApi({type:"helix",url:"eventsub/conduits",method:"POST",query:{...Oe("shard_count",e.toString())}});return new Kt(t.data[0],this._client)}async updateConduit(e,t){const r=await this._client.callApi({type:"helix",url:"eventsub/conduits",method:"PATCH",query:Wt(e,t)});return new Kt(r.data[0],this._client)}async deleteConduit(e){await this._client.callApi({type:"helix",url:"eventsub/conduits",method:"DELETE",query:{...Oe("id",e)}})}async getConduitShards(e,t,r){return{...We(await this._client.callApi({type:"helix",url:"eventsub/conduits/shards",query:{...$t(e,t),...ze(r)}}),Jt,this._client)}}getConduitShardsPaginated(e,t){return new Ge({url:"eventsub/conduits/shards",query:$t(e,t)},this._client,(e=>new Jt(e)))}async updateConduitShards(e,t){return(await this._client.callApi({type:"helix",url:"eventsub/conduits/shards",method:"PATCH",jsonBody:Vt(e,t)})).data.map((e=>new Jt(e)))}async _deleteSubscriptionsWithCondition(e){const t=this.getSubscriptionsPaginated();for await(const r of t)e&&!e(r)||await r.unsubscribe()}};Yt=o([te("api","HelixEventSubApi")],Yt);let Xt=class extends pe{get authorName(){return this[he].author_name}get bitsEnabled(){return this[he].bits_enabled}get installable(){return this[he].can_install}get configurationLocation(){return this[he].configuration_location}get description(){return this[he].description}get tosUrl(){return this[he].eula_tos_url}get hasChatSupport(){return this[he].has_chat_support}get iconUrl(){return this[he].icon_url}getIconUrl(e){return this[he].icon_urls[e]}get id(){return this[he].id}get name(){return this[he].name}get privacyPolicyUrl(){return this[he].privacy_policy_url}get requestsIdentityLink(){return this[he].request_identity_link}get screenshotUrls(){return this[he].screenshot_urls}get state(){return this[he].state}get subscriptionsSupportLevel(){return this[he].subscriptions_support_level}get summary(){return this[he].summary}get supportEmail(){return this[he].support_email}get version(){return this[he].version}get viewerSummery(){return this[he].viewer_summary}get allowedConfigUrls(){return this[he].allowlisted_config_urls}get allowedPanelUrls(){return this[he].allowlisted_panel_urls}get mobileViewerUrl(){var e,t;return null!==(t=null===(e=this[he].views.mobile)||void 0===e?void 0:e.viewer_url)&&void 0!==t?t:null}get panelViewerUrl(){var e,t;return null!==(t=null===(e=this[he].views.panel)||void 0===e?void 0:e.viewer_url)&&void 0!==t?t:null}get panelHeight(){var e,t;return null!==(t=null===(e=this[he].views.panel)||void 0===e?void 0:e.height)&&void 0!==t?t:null}get panelCanLinkExternalContent(){var e,t;return null!==(t=null===(e=this[he].views.panel)||void 0===e?void 0:e.can_link_external_content)&&void 0!==t?t:null}get overlayViewerUrl(){var e,t;return null!==(t=null===(e=this[he].views.video_overlay)||void 0===e?void 0:e.viewer_url)&&void 0!==t?t:null}get overlayCanLinkExternalContent(){var e,t;return null!==(t=null===(e=this[he].views.video_overlay)||void 0===e?void 0:e.can_link_external_content)&&void 0!==t?t:null}get componentViewerUrl(){var e,t;return null!==(t=null===(e=this[he].views.component)||void 0===e?void 0:e.viewer_url)&&void 0!==t?t:null}get componentAspectWidth(){var e,t;return null!==(t=null===(e=this[he].views.component)||void 0===e?void 0:e.aspect_width)&&void 0!==t?t:null}get componentAspectHeight(){var e,t;return null!==(t=null===(e=this[he].views.component)||void 0===e?void 0:e.aspect_height)&&void 0!==t?t:null}get componentAspectRatioX(){var e,t;return null!==(t=null===(e=this[he].views.component)||void 0===e?void 0:e.aspect_ratio_x)&&void 0!==t?t:null}get componentAspectRatioY(){var e,t;return null!==(t=null===(e=this[he].views.component)||void 0===e?void 0:e.aspect_ratio_y)&&void 0!==t?t:null}get componentAutoScales(){var e,t;return null!==(t=null===(e=this[he].views.component)||void 0===e?void 0:e.autoscale)&&void 0!==t?t:null}get componentScalePixels(){var e,t;return null!==(t=null===(e=this[he].views.component)||void 0===e?void 0:e.scale_pixels)&&void 0!==t?t:null}get componentTargetHeight(){var e,t;return null!==(t=null===(e=this[he].views.component)||void 0===e?void 0:e.target_height)&&void 0!==t?t:null}get componentSize(){var e,t;return null!==(t=null===(e=this[he].views.component)||void 0===e?void 0:e.size)&&void 0!==t?t:null}get componentZoom(){var e,t;return null!==(t=null===(e=this[he].views.component)||void 0===e?void 0:e.zoom)&&void 0!==t?t:null}get componentZoomPixels(){var e,t;return null!==(t=null===(e=this[he].views.component)||void 0===e?void 0:e.zoom_pixels)&&void 0!==t?t:null}get componentCanLinkExternalContent(){var e,t;return null!==(t=null===(e=this[he].views.component)||void 0===e?void 0:e.can_link_external_content)&&void 0!==t?t:null}get configViewerUrl(){var e,t;return null!==(t=null===(e=this[he].views.config)||void 0===e?void 0:e.viewer_url)&&void 0!==t?t:null}get configCanLinkExternalContent(){var e,t;return null!==(t=null===(e=this[he].views.config)||void 0===e?void 0:e.can_link_external_content)&&void 0!==t?t:null}};function Zt(e,t){return{extension_id:e,extension_version:t}}function er(e){return{sku:e.sku,cost:{amount:e.cost,type:"bits"},display_name:e.displayName,in_development:e.inDevelopment,expiration:e.expirationDate,is_broadcast:e.broadcast}}function tr(e,t){return{extension_id:e,id:t.transactionIds}}Xt=o([te("api","HelixExtension","id")],Xt);let rr=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].broadcaster_id}get displayName(){return this[he].broadcaster_name}async getChannel(){return Ce(await this._client.channels.getChannelInfoById(this[he].broadcaster_id))}async getBroadcaster(){return Ce(await this._client.users.getUserById(this[he].broadcaster_id))}get gameId(){return this[he].game_id}get gameName(){return this[he].game_name}async getGame(){return this[he].game_id?Ce(await this._client.games.getGameById(this[he].game_id)):null}get title(){return this[he].title}};o([ve(!1)],rr.prototype,"_client",void 0),rr=o([te("api","HelixChannelReference","id")],rr);let nr=class extends pe{get sku(){return this[he].sku}get cost(){return this[he].cost.amount}get displayName(){return this[he].display_name}get inDevelopment(){return this[he].in_development}get isBroadcast(){return this[he].is_broadcast}get expirationDate(){return f(this[he].expiration,(e=>new Date(e)))}};nr=o([te("api","HelixExtensionBitsProduct","sku")],nr);let sr=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].id}get transactionDate(){return new Date(this[he].timestamp)}get broadcasterId(){return this[he].broadcaster_id}get broadcasterName(){return this[he].broadcaster_name}get broadcasterDisplayName(){return this[he].broadcaster_name}async getBroadcaster(){return Ce(await this._client.users.getUserById(this[he].broadcaster_id))}get userId(){return this[he].user_id}get userName(){return this[he].user_login}get userDisplayName(){return this[he].user_name}async getUser(){return Ce(await this._client.users.getUserById(this[he].user_id))}get productType(){return this[he].product_type}get productSku(){return this[he].product_data.sku}get productCost(){return this[he].product_data.cost.amount}get productDisplayName(){return this[he].product_data.displayName}get productInDevelopment(){return this[he].product_data.inDevelopment}};o([ve(!1)],sr.prototype,"_client",void 0),sr=o([te("api","HelixExtensionTransaction","id")],sr);let ir=class extends xe{async getReleasedExtension(e,t){const r=await this._client.callApi({type:"helix",url:"extensions/released",query:Zt(e,t)});return new Xt(r.data[0])}async getLiveChannelsWithExtension(e,t){return We(await this._client.callApi({type:"helix",url:"extensions/live",query:{...Oe("extension_id",e),...ze(t)}}),rr,this._client)}getLiveChannelsWithExtensionPaginated(e){return new Ge({url:"extensions/live",query:Oe("extension_id",e)},this._client,(e=>new rr(e,this._client)))}async getExtensionBitsProducts(e){return(await this._client.callApi({type:"helix",url:"bits/extensions",forceType:"app",query:Oe("should_include_all",null==e?void 0:e.toString())})).data.map((e=>new nr(e)))}async putExtensionBitsProduct(e){const t=await this._client.callApi({type:"helix",url:"bits/extensions",method:"PUT",forceType:"app",jsonBody:er(e)});return new nr(t.data[0])}async getExtensionTransactions(e,t={}){return We(await this._client.callApi({type:"helix",url:"extensions/transactions",forceType:"app",query:{...tr(e,t),...ze(t)}}),sr,this._client)}getExtensionTransactionsPaginated(e,t={}){return new Ge({url:"extensions/transactions",forceType:"app",query:tr(e,t)},this._client,(e=>new sr(e,this._client)))}};ir=o([te("api","HelixExtensionsApi")],ir);let ar=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].id}get name(){return this[he].name}get boxArtUrl(){return this[he].box_art_url}get igdbId(){return this[he].igdb_id||null}getBoxArtUrl(e,t){return this[he].box_art_url.replace("{width}",e.toString()).replace("{height}",t.toString())}async getStreams(e){return await this._client.streams.getStreams({...e,game:this[he].id})}getStreamsPaginated(){return this._client.streams.getStreamsPaginated({game:this[he].id})}};o([ve(!1)],ar.prototype,"_client",void 0),ar=o([te("api","HelixGame","id")],ar);let or=class extends xe{constructor(){super(...arguments),this._getGameByIdBatcher=new Me({url:"games"},"id","id",this._client,(e=>new ar(e,this._client))),this._getGameByNameBatcher=new Me({url:"games"},"name","name",this._client,(e=>new ar(e,this._client))),this._getGameByIgdbIdBatcher=new Me({url:"games"},"igdb_id","igdb_id",this._client,(e=>new ar(e,this._client)))}async getGamesByIds(e){return await this._getGames("id",e)}async getGamesByNames(e){return await this._getGames("name",e)}async getGamesByIgdbIds(e){return await this._getGames("igdb_id",e)}async getGameById(e){var t;return null!==(t=(await this._getGames("id",[e]))[0])&&void 0!==t?t:null}async getGameByName(e){var t;return null!==(t=(await this._getGames("name",[e]))[0])&&void 0!==t?t:null}async getGameByIgdbId(e){var t;return null!==(t=(await this._getGames("igdb_id",[e]))[0])&&void 0!==t?t:null}async getGameByIdBatched(e){return await this._getGameByIdBatcher.request(e)}async getGameByNameBatched(e){return await this._getGameByNameBatcher.request(e)}async getGameByIgdbIdBatched(e){return await this._getGameByIgdbIdBatcher.request(e)}async getTopGames(e){return We(await this._client.callApi({type:"helix",url:"games/top",query:ze(e)}),ar,this._client)}getTopGamesPaginated(){return new Ge({url:"games/top"},this._client,(e=>new ar(e,this._client)))}async _getGames(e,t){return t.length?(await this._client.callApi({type:"helix",url:"games",query:{[e]:t}})).data.map((e=>new ar(e,this._client))):[]}};o([ve(!1)],or.prototype,"_getGameByIdBatcher",void 0),o([ve(!1)],or.prototype,"_getGameByNameBatcher",void 0),o([ve(!1)],or.prototype,"_getGameByIgdbIdBatcher",void 0),or=o([te("api","HelixGameApi")],or);let lr=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].id}get broadcasterId(){return this[he].broadcaster_id}get broadcasterDisplayName(){return this[he].broadcaster_name}get broadcasterName(){return this[he].broadcaster_login}async getBroadcaster(){return Ce(await this._client.users.getUserById(this[he].broadcaster_id))}get type(){return this[he].type}get description(){return this[he].description}get currentAmount(){return this[he].current_amount}get targetAmount(){return this[he].target_amount}get creationDate(){return this[he].created_at}};o([ve(!1)],lr.prototype,"_client",void 0),lr=o([te("api","HelixGoal","id")],lr);let cr=class extends xe{async getGoals(t){return(await this._client.callApi({type:"helix",url:"goals",userId:e(t),scopes:["channel:read:goals"],query:fe(t)})).data.map((e=>new lr(e,this._client)))}};cr=o([te("api","HelixGoalApi")],cr);let ur=class extends pe{constructor(e,t){super(e),this._client=t}get userId(){return this[he].user}async getUser(){return Ce(await this._client.users.getUserById(this[he].user))}get type(){return this[he].type}get total(){return this[he].total}};o([ve(!1)],ur.prototype,"_client",void 0),ur=o([te("api","HelixHypeTrainContribution","userId")],ur);let dr=class extends pe{constructor(e,t){super(e),this._client=t}get eventId(){return this[he].id}get eventType(){return this[he].event_type}get eventDate(){return new Date(this[he].event_timestamp)}get eventVersion(){return this[he].version}get id(){return this[he].event_data.id}get broadcasterId(){return this[he].event_data.broadcaster_id}async getBroadcaster(){return Ce(await this._client.users.getUserById(this[he].event_data.broadcaster_id))}get level(){return this[he].event_data.level}get startDate(){return new Date(this[he].event_data.started_at)}get expiryDate(){return new Date(this[he].event_data.expires_at)}get cooldownDate(){return new Date(this[he].event_data.cooldown_end_time)}get total(){return this[he].event_data.total}get goal(){return this[he].event_data.goal}get lastContribution(){return new ur(this[he].event_data.last_contribution,this._client)}get topContributions(){return this[he].event_data.top_contributions.map((e=>new ur(e,this._client)))}};o([ve(!1)],dr.prototype,"_client",void 0),dr=o([te("api","HelixHypeTrainEvent","id")],dr);class hr extends xe{async getHypeTrainEventsForBroadcaster(t,r){return We(await this._client.callApi({type:"helix",url:"hypetrain/events",userId:e(t),scopes:["channel:read:hype_train"],query:{...fe(t),...ze(r)}}),dr,this._client)}getHypeTrainEventsForBroadcasterPaginated(t){return new Ge({url:"hypetrain/events",userId:e(t),scopes:["channel:read:hype_train"],query:fe(t)},this._client,(e=>new dr(e,this._client)))}}function pr(t,r){return{broadcaster_id:e(t),user_id:null==r?void 0:r.userId}}function gr(t,r){return{broadcaster_id:e(t),user_id:e(r)}}function _r(t,r,n,s,i){return{unban_request_id:n,broadcaster_id:e(t),moderator_id:e(r),status:s?"approved":"denied",resolution_text:i}}function mr(t,r,n){return{user_id:e(t),msg_id:r,action:n?"ALLOW":"DENY"}}function yr(e){return{overall_level:e.overallLevel,aggression:e.aggression,bullying:e.bullying,disability:e.disability,misogyny:e.misogyny,race_ethnicity_or_religion:e.raceEthnicityOrReligion,sex_based_terms:e.sexBasedTerms,sexuality_sex_or_gender:e.sexualitySexOrGender,swearing:e.swearing}}function wr(t){return{data:{duration:t.duration,reason:t.reason,user_id:e(t.user)}}}function fr(e){return{is_active:e}}function br(e){return{data:e.map((e=>({msg_id:e.messageId,msg_text:e.messageText})))}}function vr(t,r){return{data:{user_id:e(t),reason:r}}}let xr=class extends pe{get broadcasterId(){return this[he].broadcaster_id}get moderatorId(){return this[he].moderator_id}get overallLevel(){return this[he].overall_level?this[he].overall_level:null}get disability(){return this[he].disability}get aggression(){return this[he].aggression}get sexualitySexOrGender(){return this[he].sexuality_sex_or_gender}get misogyny(){return this[he].misogyny}get bullying(){return this[he].bullying}get swearing(){return this[he].swearing}get raceEthnicityOrReligion(){return this[he].race_ethnicity_or_religion}get sexBasedTerms(){return this[he].sex_based_terms}};xr=o([te("api","HelixAutoModSettings","broadcasterId")],xr);let Ir=class extends pe{get messageId(){return this[he].msg_id}get isPermitted(){return this[he].is_permitted}};Ir=o([te("api","HelixAutoModStatus","messageId")],Ir);let Cr=class extends pe{constructor(e,t,r){super(e),this._expiryTimestamp=t,this._client=r}get creationDate(){return new Date(this[he].created_at)}get expiryDate(){return f(this._expiryTimestamp,(e=>new Date(e)))}get moderatorId(){return this[he].moderator_id}async getModerator(){return Ce(await this._client.users.getUserById(this[he].moderator_id))}get userId(){return this[he].user_id}async getUser(){return Ce(await this._client.users.getUserById(this[he].user_id))}};o([ve(!1)],Cr.prototype,"_client",void 0),o([ve(!1)],Cr.prototype,"_expiryTimestamp",void 0),Cr=o([te("api","HelixBanUser","userId")],Cr);let Sr=class extends Cr{constructor(e,t){super(e,e.expires_at||null,t)}get userName(){return this[he].user_login}get userDisplayName(){return this[he].user_name}get moderatorName(){return this[he].moderator_login}get moderatorDisplayName(){return this[he].moderator_name}get reason(){return this[he].reason||null}};Sr=o([te("api","HelixBan","userId")],Sr);let Ar=class extends pe{get broadcasterId(){return this[he].broadcaster_id}get creationDate(){return new Date(this[he].created_at)}get expirationDate(){return this[he].expires_at?new Date(this[he].expires_at):null}get id(){return this[he].id}get moderatorId(){return this[he].moderator_id}get text(){return this[he].text}get updatedDate(){return new Date(this[he].updated_at)}};Ar=o([te("api","HelixBlockedTerm","id")],Ar);let Br=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].broadcaster_id}get name(){return this[he].broadcaster_login}get displayName(){return this[he].broadcaster_name}async getChannel(){return Ce(await this._client.channels.getChannelInfoById(this[he].broadcaster_id))}async getBroadcaster(){return Ce(await this._client.users.getUserById(this[he].broadcaster_id))}};o([ve(!1)],Br.prototype,"_client",void 0),Br=o([te("api","HelixModeratedChannel","id")],Br);let Tr=class extends pe{constructor(e,t){super(e),this._client=t}get userId(){return this[he].user_id}get userName(){return this[he].user_login}get userDisplayName(){return this[he].user_name}async getUser(){return Ce(await this._client.users.getUserById(this[he].user_id))}};o([ve(!1)],Tr.prototype,"_client",void 0),Tr=o([te("api","HelixModerator","userId")],Tr);let Er=class extends pe{constructor(e,t){super(e),this._client=t}get isActive(){return this[he].is_active}get moderatorId(){return this[he].moderator_id}get moderatorName(){return this[he].moderator_login}get moderatorDisplayName(){return this[he].moderator_name}async getModerator(){return Ce(await this._client.users.getUserById(this[he].moderator_id))}get lastActivationDate(){return""===this[he].last_activated_at?null:new Date(this[he].last_activated_at)}};o([ve(!1)],Er.prototype,"_client",void 0),Er=o([te("api","HelixShieldModeStatus")],Er);let Ur=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].id}get broadcasterId(){return this[he].broadcaster_id}get broadcasterName(){return this[he].broadcaster_id}get broadcasterDisplayName(){return this[he].broadcaster_id}async getBroadcaster(){return Ce(await this._client.users.getUserById(this[he].broadcaster_id))}get moderatorId(){return this[he].moderator_id}get moderatorName(){return this[he].moderator_login}get moderatorDisplayName(){return this[he].moderator_name}async getModerator(){return Ce(await this._client.users.getUserById(this[he].moderator_id))}get userId(){return this[he].user_id}get userName(){return this[he].user_login}get userDisplayName(){return this[he].user_name}async getUser(){return Ce(await this._client.users.getUserById(this[he].user_id))}get message(){return this[he].text}get creationDate(){return new Date(this[he].created_at)}get resolutionMessage(){return this[he].resolution_text||null}get resolutionDate(){return f(this[he].resolved_at,(e=>new Date(e)))}};o([ve(!1)],Ur.prototype,"_client",void 0),Ur=o([te("api","HelixUnbanRequest","id")],Ur);let Dr=class extends pe{constructor(e,t){super(e),this._client=t}get broadcasterId(){return this[he].user_id}async getBroadcaster(){return Ce(await this._client.users.getUserById(this[he].broadcaster_id))}get moderatorId(){return this[he].moderator_id}async getModerator(){return Ce(await this._client.users.getUserById(this[he].moderator_id))}get userId(){return this[he].user_id}async getUser(){return Ce(await this._client.users.getUserById(this[he].user_id))}get reason(){return this[he].reason}};o([ve(!1)],Dr.prototype,"_client",void 0),Dr=o([te("api","HelixWarning","userId")],Dr);let qr=class extends xe{async getBannedUsers(t,r){return We(await this._client.callApi({type:"helix",url:"moderation/banned",userId:e(t),scopes:["moderation:read"],query:{...pr(t,r),...ze(r)}}),Sr,this._client)}getBannedUsersPaginated(t){return new Ge({url:"moderation/banned",userId:e(t),scopes:["moderation:read"],query:fe(t)},this._client,(e=>new Sr(e,this._client)),50)}async checkUserBan(t,r){const n=e(r);return(await this.getBannedUsers(t,{userId:n})).data.some((e=>e.userId===n))}async getModerators(t,r){return We(await this._client.callApi({type:"helix",url:"moderation/moderators",userId:e(t),scopes:["moderation:read","channel:manage:moderators"],query:{...pr(t,r),...ze(r)}}),Tr,this._client)}getModeratorsPaginated(t){return new Ge({url:"moderation/moderators",userId:e(t),scopes:["moderation:read","channel:manage:moderators"],query:fe(t)},this._client,(e=>new Tr(e,this._client)))}async getModeratedChannels(t,r){const n=e(t);return We(await this._client.callApi({type:"helix",url:"moderation/channels",userId:n,scopes:["user:read:moderated_channels"],query:{...Oe("user_id",n),...ze(r)}}),Br,this._client)}getModeratedChannelsPaginated(t){const r=e(t);return new Ge({url:"moderation/channels",userId:r,scopes:["user:read:moderated_channels"],query:Oe("user_id",r)},this._client,(e=>new Br(e,this._client)))}async checkUserMod(t,r){const n=e(r);return(await this.getModerators(t,{userId:n})).data.some((e=>e.userId===n))}async addModerator(t,r){await this._client.callApi({type:"helix",url:"moderation/moderators",method:"POST",userId:e(t),scopes:["channel:manage:moderators"],query:gr(t,r)})}async removeModerator(t,r){await this._client.callApi({type:"helix",url:"moderation/moderators",method:"DELETE",userId:e(t),scopes:["channel:manage:moderators"],query:gr(t,r)})}async checkAutoModStatus(t,r){return(await this._client.callApi({type:"helix",url:"moderation/enforcements/status",method:"POST",userId:e(t),scopes:["moderation:read"],query:fe(t),jsonBody:br(r)})).data.map((e=>new Ir(e)))}async processHeldAutoModMessage(t,r,n){await this._client.callApi({type:"helix",url:"moderation/automod/message",method:"POST",userId:e(t),scopes:["moderator:manage:automod"],jsonBody:mr(t,r,n)})}async getAutoModSettings(t){const r=e(t);return(await this._client.callApi({type:"helix",url:"moderation/automod/settings",userId:r,scopes:["moderator:read:automod_settings"],canOverrideScopedUserContext:!0,query:this._createModeratorActionQuery(r)})).data.map((e=>new xr(e)))}async updateAutoModSettings(t,r){const n=e(t);return(await this._client.callApi({type:"helix",url:"moderation/automod/settings",method:"PUT",userId:n,scopes:["moderator:manage:automod_settings"],canOverrideScopedUserContext:!0,query:this._createModeratorActionQuery(n),jsonBody:yr(r)})).data.map((e=>new xr(e)))}async banUser(t,r){const n=e(t);return(await this._client.callApi({type:"helix",url:"moderation/bans",method:"POST",userId:n,scopes:["moderator:manage:banned_users"],canOverrideScopedUserContext:!0,query:this._createModeratorActionQuery(n),jsonBody:wr(r)})).data.map((e=>new Cr(e,e.end_time,this._client)))}async unbanUser(t,r){const n=e(t);await this._client.callApi({type:"helix",url:"moderation/bans",method:"DELETE",userId:n,scopes:["moderator:manage:banned_users"],canOverrideScopedUserContext:!0,query:{...this._createModeratorActionQuery(n),...Oe("user_id",e(r))}})}async getBlockedTerms(t,r){const n=e(t);return We(await this._client.callApi({type:"helix",url:"moderation/blocked_terms",userId:n,scopes:["moderator:read:blocked_terms"],canOverrideScopedUserContext:!0,query:{...this._createModeratorActionQuery(n),...ze(r)}}),Ar,this._client)}async addBlockedTerm(t,r){const n=e(t);return(await this._client.callApi({type:"helix",url:"moderation/blocked_terms",method:"POST",userId:n,scopes:["moderator:manage:blocked_terms"],canOverrideScopedUserContext:!0,query:this._createModeratorActionQuery(n),jsonBody:{text:r}})).data.map((e=>new Ar(e)))}async removeBlockedTerm(t,r,n){const s=e(t);await this._client.callApi({type:"helix",url:"moderation/blocked_terms",method:"DELETE",userId:s,scopes:["moderator:manage:blocked_terms"],canOverrideScopedUserContext:!0,query:{...this._createModeratorActionQuery(s),id:n}})}async deleteChatMessages(t,r){const n=e(t);await this._client.callApi({type:"helix",url:"moderation/chat",method:"DELETE",userId:n,scopes:["moderator:manage:chat_messages"],canOverrideScopedUserContext:!0,query:{...this._createModeratorActionQuery(n),...Oe("message_id",r)}})}async getShieldModeStatus(t){const r=e(t),n=await this._client.callApi({type:"helix",url:"moderation/shield_mode",method:"GET",userId:r,scopes:["moderator:read:shield_mode","moderator:manage:shield_mode"],canOverrideScopedUserContext:!0,query:this._createModeratorActionQuery(r)});return new Er(n.data[0],this._client)}async updateShieldModeStatus(t,r){const n=e(t),s=await this._client.callApi({type:"helix",url:"moderation/shield_mode",method:"PUT",userId:n,scopes:["moderator:manage:shield_mode"],canOverrideScopedUserContext:!0,query:this._createModeratorActionQuery(n),jsonBody:fr(r)});return new Er(s.data[0],this._client)}async getUnbanRequests(t,r,n){const s=e(t);return We(await this._client.callApi({type:"helix",url:"moderation/unban_requests",method:"GET",userId:s,scopes:["moderator:read:unban_requests","moderator:manage:unban_requests"],canOverrideScopedUserContext:!0,query:{...this._createModeratorActionQuery(s),...Oe("status",r),...ze(n)}}),Ur,this._client)}getUnbanRequestsPaginated(t,r){const n=e(t);return new Ge({url:"moderation/unban_requests",method:"GET",userId:n,scopes:["moderator:read:unban_requests","moderator:manage:unban_requests"],canOverrideScopedUserContext:!0,query:{...this._createModeratorActionQuery(n),...Oe("status",r)}},this._client,(e=>new Ur(e,this._client)))}async resolveUnbanRequest(t,r,n,s){const i=e(t),a=await this._client.callApi({type:"helix",url:"moderation/unban_requests",method:"PATCH",userId:i,scopes:["moderator:manage:unban_requests"],canOverrideScopedUserContext:!0,query:_r(i,this._getUserContextIdWithDefault(i),r,n,null==s?void 0:s.slice(0,500))});return new Ur(a.data[0],this._client)}async warnUser(t,r,n){const s=e(t),i=await this._client.callApi({type:"helix",url:"moderation/warnings",method:"POST",userId:s,scopes:["moderator:manage:warnings"],canOverrideScopedUserContext:!0,query:this._createModeratorActionQuery(s),jsonBody:vr(r,n.slice(0,500))});return new Dr(i.data[0],this._client)}_createModeratorActionQuery(e){return Ne(e,this._getUserContextIdWithDefault(e))}};function Pr(t,r){var n;return{broadcaster_id:e(t),title:r.title,choices:r.choices.map((e=>({title:e}))),duration:r.duration,channel_points_voting_enabled:null!=r.channelPointsPerVote,channel_points_per_vote:null!==(n=r.channelPointsPerVote)&&void 0!==n?n:0}}function Rr(t,r,n){return{broadcaster_id:e(t),id:r,status:n?"TERMINATED":"ARCHIVED"}}qr=o([te("api","HelixModerationApi")],qr);let Or=class extends pe{get id(){return this[he].id}get title(){return this[he].title}get totalVotes(){return this[he].votes}get channelPointsVotes(){return this[he].channel_points_votes}};Or=o([te("api","HelixPollChoice","id")],Or);let kr=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].id}get broadcasterId(){return this[he].broadcaster_id}get broadcasterName(){return this[he].broadcaster_login}get broadcasterDisplayName(){return this[he].broadcaster_name}async getBroadcaster(){return Ce(await this._client.users.getUserById(this[he].broadcaster_id))}get title(){return this[he].title}get isChannelPointsVotingEnabled(){return this[he].channel_points_voting_enabled}get channelPointsPerVote(){return this[he].channel_points_per_vote}get status(){return this[he].status}get durationInSeconds(){return this[he].duration}get startDate(){return new Date(this[he].started_at)}get endDate(){return new Date(this.startDate.getTime()+1e3*this[he].duration)}get choices(){return this[he].choices.map((e=>new Or(e)))}};o([ve(!1)],kr.prototype,"_client",void 0),kr=o([te("api","HelixPoll","id")],kr);let Nr=class extends xe{async getPolls(t,r){return We(await this._client.callApi({type:"helix",url:"polls",userId:e(t),scopes:["channel:read:polls"],query:{...fe(t),...ze(r)}}),kr,this._client)}getPollsPaginated(t){return new Ge({url:"polls",userId:e(t),scopes:["channel:read:polls"],query:fe(t)},this._client,(e=>new kr(e,this._client)),20)}async getPollsByIds(t,r){return r.length?(await this._client.callApi({type:"helix",url:"polls",userId:e(t),scopes:["channel:read:polls"],query:je(t,r)})).data.map((e=>new kr(e,this._client))):[]}async getPollById(e,t){const r=await this.getPollsByIds(e,[t]);return r.length?r[0]:null}async createPoll(t,r){const n=await this._client.callApi({type:"helix",url:"polls",method:"POST",userId:e(t),scopes:["channel:manage:polls"],jsonBody:Pr(t,r)});return new kr(n.data[0],this._client)}async endPoll(t,r,n=!0){const s=await this._client.callApi({type:"helix",url:"polls",method:"PATCH",userId:e(t),scopes:["channel:manage:polls"],jsonBody:Rr(t,r,n)});return new kr(s.data[0],this._client)}};function jr(t,r){return{broadcaster_id:e(t),title:r.title,outcomes:r.outcomes.map((e=>({title:e}))),prediction_window:r.autoLockAfter}}function Fr(t,r,n,s){return{broadcaster_id:e(t),id:r,status:n,winning_outcome_id:s}}Nr=o([te("api","HelixPollApi")],Nr);let Hr=class extends pe{constructor(e,t){super(e),this._client=t}get userId(){return this[he].user_id}get userName(){return this[he].user_login}get userDisplayName(){return this[he].user_name}async getUser(){return await this._client.users.getUserById(this[he].user_id)}get channelPointsUsed(){return this[he].channel_points_used}get channelPointsWon(){return this[he].channel_points_won}};o([ve(!1)],Hr.prototype,"_client",void 0),Hr=o([te("api","HelixPredictor","userId")],Hr);let Mr=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].id}get title(){return this[he].title}get users(){return this[he].users}get totalChannelPoints(){return this[he].channel_points}get color(){return this[he].color}get topPredictors(){var e,t;return null!==(t=null===(e=this[he].top_predictors)||void 0===e?void 0:e.map((e=>new Hr(e,this._client))))&&void 0!==t?t:[]}};o([ve(!1)],Mr.prototype,"_client",void 0),Mr=o([te("api","HelixPredictionOutcome","id")],Mr);let Lr=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].id}get broadcasterId(){return this[he].broadcaster_id}get broadcasterName(){return this[he].broadcaster_login}get broadcasterDisplayName(){return this[he].broadcaster_name}async getBroadcaster(){return Ce(await this._client.users.getUserById(this[he].broadcaster_id))}get title(){return this[he].title}get status(){return this[he].status}get autoLockAfter(){return this[he].prediction_window}get creationDate(){return new Date(this[he].created_at)}get endDate(){return this[he].ended_at?new Date(this[he].ended_at):null}get lockDate(){return this[he].locked_at?new Date(this[he].locked_at):null}get outcomes(){return this[he].outcomes.map((e=>new Mr(e,this._client)))}get winningOutcomeId(){return this[he].winning_outcome_id||null}get winningOutcome(){if(!this[he].winning_outcome_id)return null;const e=this[he].outcomes.find((e=>e.id===this[he].winning_outcome_id));if(!e)throw new ye("Winning outcome not found in outcomes array");return new Mr(e,this._client)}};o([ve(!1)],Lr.prototype,"_client",void 0),Lr=o([te("api","HelixPrediction","id")],Lr);let Gr=class extends xe{async getPredictions(t,r){return We(await this._client.callApi({type:"helix",url:"predictions",userId:e(t),scopes:["channel:read:predictions"],query:{...fe(t),...ze(r)}}),Lr,this._client)}getPredictionsPaginated(t){return new Ge({url:"predictions",userId:e(t),scopes:["channel:read:predictions"],query:fe(t)},this._client,(e=>new Lr(e,this._client)),20)}async getPredictionsByIds(t,r){return r.length?(await this._client.callApi({type:"helix",url:"predictions",userId:e(t),scopes:["channel:read:predictions"],query:je(t,r)})).data.map((e=>new Lr(e,this._client))):[]}async getPredictionById(e,t){const r=await this.getPredictionsByIds(e,[t]);return r.length?r[0]:null}async createPrediction(t,r){const n=await this._client.callApi({type:"helix",url:"predictions",method:"POST",userId:e(t),scopes:["channel:manage:predictions"],jsonBody:jr(t,r)});return new Lr(n.data[0],this._client)}async lockPrediction(e,t){return await this._endPrediction(e,t,"LOCKED")}async resolvePrediction(e,t,r){return await this._endPrediction(e,t,"RESOLVED",r)}async cancelPrediction(e,t){return await this._endPrediction(e,t,"CANCELED")}async _endPrediction(t,r,n,s){const i=await this._client.callApi({type:"helix",url:"predictions",method:"PATCH",userId:e(t),scopes:["channel:manage:predictions"],jsonBody:Fr(t,r,n,s)});return new Lr(i.data[0],this._client)}};function $r(t,r){return{from_broadcaster_id:e(t),to_broadcaster_id:e(r)}}Gr=o([te("api","HelixPredictionApi")],Gr);let Wr=class extends pe{get creationDate(){return new Date(this[he].created_at)}get targetIsMature(){return this[he].is_mature}};Wr=o([te("api","HelixRaid")],Wr);let Vr=class extends xe{async startRaid(t,r){const n=await this._client.callApi({type:"helix",url:"raids",method:"POST",userId:e(t),scopes:["channel:manage:raids"],query:$r(t,r)});return new Wr(n.data[0])}async cancelRaid(t){await this._client.callApi({type:"helix",url:"raids",method:"DELETE",userId:e(t),scopes:["channel:manage:raids"],query:fe(t)})}};function zr(t,r){var n;return{broadcaster_id:e(t),start_time:null==r?void 0:r.startDate,utc_offset:null===(n=null==r?void 0:r.utcOffset)||void 0===n?void 0:n.toString()}}function Qr(t,r){return r.vacation?{broadcaster_id:e(t),is_vacation_enabled:"true",vacation_start_time:r.vacation.startDate,vacation_end_time:r.vacation.endDate,timezone:r.vacation.timezone}:{broadcaster_id:e(t),is_vacation_enabled:"false"}}function Kr(e){return{start_time:e.startDate,timezone:e.timezone,is_recurring:e.isRecurring,duration:e.duration,category_id:e.categoryId,title:e.title}}function Jr(t,r){return{broadcaster_id:e(t),id:r}}function Yr(e){return{start_time:e.startDate,timezone:e.timezone,is_canceled:e.isCanceled,duration:e.duration,category_id:e.categoryId,title:e.title}}Vr=o([te("api","HelixRaidApi")],Vr);let Xr=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].id}get startDate(){return new Date(this[he].start_time)}get endDate(){return new Date(this[he].end_time)}get title(){return this[he].title}get cancelEndDate(){return f(this[he].canceled_until,(e=>new Date(e)))}get categoryId(){var e,t;return null!==(t=null===(e=this[he].category)||void 0===e?void 0:e.id)&&void 0!==t?t:null}get categoryName(){var e,t;return null!==(t=null===(e=this[he].category)||void 0===e?void 0:e.name)&&void 0!==t?t:null}async getCategory(){var e;const t=null===(e=this[he].category)||void 0===e?void 0:e.id;return t?await this._client.games.getGameById(t):null}get isRecurring(){return this[he].is_recurring}};o([ve(!1)],Xr.prototype,"_client",void 0),Xr=o([te("api","HelixScheduleSegment","id")],Xr);let Zr=class extends Ge{constructor(e,t,r){super({url:"schedule",query:zr(e,r)},t,(e=>new Xr(e,t)),25)}async _fetchData(e={}){var t;const r=await super._fetchData(e);return{data:null!==(t=r.data.segments)&&void 0!==t?t:[],pagination:r.pagination}}};Zr=o([te("api","HelixPaginatedScheduleSegmentRequest")],Zr);let en=class extends pe{constructor(e,t){super(e),this._client=t}get segments(){var e,t;return null!==(t=null===(e=this[he].segments)||void 0===e?void 0:e.map((e=>new Xr(e,this._client))))&&void 0!==t?t:[]}get broadcasterId(){return this[he].broadcaster_id}get broadcasterName(){return this[he].broadcaster_login}get broadcasterDisplayName(){return this[he].broadcaster_name}async getBroadcaster(){return Ce(await this._client.users.getUserById(this[he].broadcaster_id))}get vacationStartDate(){var e;const t=null===(e=this[he].vacation)||void 0===e?void 0:e.start_time;return t?new Date(t):null}get vacationEndDate(){var e;const t=null===(e=this[he].vacation)||void 0===e?void 0:e.end_time;return t?new Date(t):null}};o([ve(!1)],en.prototype,"_client",void 0),en=o([te("api","HelixSchedule","broadcasterId")],en);class tn extends xe{async getSchedule(t,r){const n=await this._client.callApi({type:"helix",url:"schedule",userId:e(t),query:{...zr(t,r),...ze(r)}});return{data:new en(n.data,this._client),cursor:n.pagination.cursor}}getScheduleSegmentsPaginated(e,t){return new Zr(e,this._client,t)}async getScheduleSegmentsByIds(t,r){var n,s;return null!==(s=null===(n=(await this._client.callApi({type:"helix",url:"schedule",userId:e(t),query:je(t,r)})).data.segments)||void 0===n?void 0:n.map((e=>new Xr(e,this._client))))&&void 0!==s?s:[]}async getScheduleSegmentById(e,t){const r=await this.getScheduleSegmentsByIds(e,[t]);return r.length?r[0]:null}async getScheduleAsIcal(e){return await this._client.callApi({type:"helix",url:"schedule/icalendar",query:fe(e)})}async updateScheduleSettings(t,r){await this._client.callApi({type:"helix",url:"schedule/settings",method:"PATCH",userId:e(t),scopes:["channel:manage:schedule"],query:Qr(t,r)})}async createScheduleSegment(t,r){const n=await this._client.callApi({type:"helix",url:"schedule/segment",method:"POST",userId:e(t),scopes:["channel:manage:schedule"],query:fe(t),jsonBody:Kr(r)});return new Xr(n.data.segments[0],this._client)}async updateScheduleSegment(t,r,n){const s=await this._client.callApi({type:"helix",url:"schedule/segment",method:"PATCH",userId:e(t),scopes:["channel:manage:schedule"],query:Jr(t,r),jsonBody:Yr(n)});return new Xr(s.data.segments[0],this._client)}async deleteScheduleSegment(t,r){await this._client.callApi({type:"helix",url:"schedule/segment",method:"DELETE",userId:e(t),scopes:["channel:manage:schedule"],query:Jr(t,r)})}}function rn(e,t){var r;return{query:e,live_only:null===(r=t.liveOnly)||void 0===r?void 0:r.toString()}}let nn=class extends pe{constructor(e,t){super(e),this._client=t}get language(){return this[he].broadcaster_language}get id(){return this[he].id}get name(){return this[he].broadcaster_login}get displayName(){return this[he].display_name}async getUser(){return Ce(await this._client.users.getUserById(this[he].id))}get gameId(){return this[he].game_id}get gameName(){return this[he].game_name}async getGame(){return this[he].game_id?Ce(await this._client.games.getGameById(this[he].game_id)):null}get isLive(){return this[he].is_live}get tags(){return this[he].tags}get thumbnailUrl(){return this[he].thumbnail_url}get startDate(){return this[he].is_live?new Date(this[he].started_at):null}};o([ve(!1)],nn.prototype,"_client",void 0),nn=o([te("api","HelixChannelSearchResult","id")],nn);let sn=class extends xe{async searchCategories(e,t){return We(await this._client.callApi({type:"helix",url:"search/categories",query:{query:e,...ze(t)}}),ar,this._client)}searchCategoriesPaginated(e){return new Ge({url:"search/categories",query:{query:e}},this._client,(e=>new ar(e,this._client)))}async searchChannels(e,t={}){return We(await this._client.callApi({type:"helix",url:"search/channels",query:{...rn(e,t),...ze(t)}}),nn,this._client)}searchChannelsPaginated(e,t={}){return new Ge({url:"search/channels",query:rn(e,t)},this._client,(e=>new nn(e,this._client)))}};function an(e){var t;return(t=[]).concat.apply(t,c([],l(e),!1))}sn=o([te("api","HelixSearchApi")],sn);class on extends J{constructor(e){super("Your stream needs to be live to do this",e)}}function ln(e){return{game_id:e.game,language:e.language,type:e.type,user_id:e.userId,user_login:e.userName}}function cn(t,r){return{user_id:e(t),description:r}}function un(e){return{video_id:e}}let dn=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].id}get userId(){return this[he].user_id}get userName(){return this[he].user_login}get userDisplayName(){return this[he].user_name}async getUser(){return Ce(await this._client.users.getUserById(this[he].user_id))}get gameId(){return this[he].game_id}get gameName(){return this[he].game_name}async getGame(){return this[he].game_id?Ce(await this._client.games.getGameById(this[he].game_id)):null}get type(){return this[he].type}get title(){return this[he].title}get viewers(){return this[he].viewer_count}get startDate(){return new Date(this[he].started_at)}get language(){return this[he].language}get thumbnailUrl(){return this[he].thumbnail_url}getThumbnailUrl(e,t){return this[he].thumbnail_url.replace("{width}",e.toString()).replace("{height}",t.toString())}get tags(){return this[he].tags}get isMature(){return this[he].is_mature}};o([ve(!1)],dn.prototype,"_client",void 0),dn=o([te("api","HelixStream","id")],dn);let hn=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].id}get creationDate(){return new Date(this[he].created_at)}get description(){return this[he].description}get positionInSeconds(){return this[he].position_seconds}};o([ve(!1)],hn.prototype,"_client",void 0),hn=o([te("api","HelixStreamMarker","id")],hn);let pn=class extends hn{constructor(e,t,r){super(e,r),this._videoId=t}get url(){return this[he].URL}get videoId(){return this._videoId}async getVideo(){return Ce(await this._client.videos.getVideoById(this._videoId))}};var gn;pn=o([te("api","HelixStreamMarkerWithVideo","id")],pn);let _n=gn=class extends xe{constructor(){super(...arguments),this._getStreamByUserIdBatcher=new Me({url:"streams"},"user_id","user_id",this._client,(e=>new dn(e,this._client))),this._getStreamByUserNameBatcher=new Me({url:"streams"},"user_login","user_login",this._client,(e=>new dn(e,this._client)))}async getStreams(e={}){return We(await this._client.callApi({url:"streams",type:"helix",query:{...ln(e),...ze(e)}}),dn,this._client)}getStreamsPaginated(e={}){return new Ge({url:"streams",query:ln(e)},this._client,(e=>new dn(e,this._client)))}async getStreamsByUserNames(e){return(await this.getStreams({userName:e.map(t)})).data}async getStreamByUserName(e){var t;return null!==(t=(await this.getStreamsByUserNames([e]))[0])&&void 0!==t?t:null}async getStreamByUserNameBatched(e){return await this._getStreamByUserNameBatcher.request(t(e))}async getStreamsByUserIds(t){return(await this.getStreams({userId:t.map(e)})).data}async getStreamByUserId(t){const r=e(t);return f((await this._client.callApi({url:"streams",type:"helix",userId:r,query:ln({userId:r})})).data[0],(e=>new dn(e,this._client)))}async getStreamByUserIdBatched(t){return await this._getStreamByUserIdBatcher.request(e(t))}async getStreamMarkersForUser(t,r){var n;const s=await this._client.callApi({url:"streams/markers",type:"helix",query:{...ke(t),...ze(r)},userId:e(t),scopes:["user:read:broadcast"],canOverrideScopedUserContext:!0});return{data:an(s.data.map((e=>gn._mapGetStreamMarkersResult(e,this._client)))),cursor:null===(n=s.pagination)||void 0===n?void 0:n.cursor}}getStreamMarkersForUserPaginated(t){return new Ge({url:"streams/markers",query:ke(t),userId:e(t),scopes:["user:read:broadcast"],canOverrideScopedUserContext:!0},this._client,(e=>gn._mapGetStreamMarkersResult(e,this._client)))}async getStreamMarkersForVideo(t,r,n){var s;const i=await this._client.callApi({url:"streams/markers",type:"helix",query:{...un(r),...ze(n)},userId:e(t),scopes:["user:read:broadcast"],canOverrideScopedUserContext:!0});return{data:an(i.data.map((e=>gn._mapGetStreamMarkersResult(e,this._client)))),cursor:null===(s=i.pagination)||void 0===s?void 0:s.cursor}}getStreamMarkersForVideoPaginated(t,r){return new Ge({url:"streams/markers",query:un(r),userId:e(t),scopes:["user:read:broadcast"],canOverrideScopedUserContext:!0},this._client,(e=>gn._mapGetStreamMarkersResult(e,this._client)))}async createStreamMarker(t,r){try{const n=await this._client.callApi({url:"streams/markers",method:"POST",type:"helix",userId:e(t),scopes:["channel:manage:broadcast"],canOverrideScopedUserContext:!0,jsonBody:cn(t,r)});return new hn(n.data[0],this._client)}catch(e){if(e instanceof Y&&404===e.statusCode)throw new on({cause:e});throw e}}async getStreamKey(t){const r=e(t);return(await this._client.callApi({type:"helix",url:"streams/key",userId:r,scopes:["channel:read:stream_key"],query:fe(t)})).data[0].stream_key}async getFollowedStreams(t,r){const n=e(t);return We(await this._client.callApi({type:"helix",url:"streams/followed",userId:n,scopes:["user:read:follows"],query:{...Oe("user_id",n),...ze(r)}}),dn,this._client)}getFollowedStreamsPaginated(t){const r=e(t);return new Ge({url:"streams/followed",userId:r,scopes:["user:read:follows"],query:Oe("user_id",r)},this._client,(e=>new dn(e,this._client)))}static _mapGetStreamMarkersResult(e,t){return e.videos.reduce(((e,r)=>[...e,...r.markers.map((e=>new pn(e,r.video_id,t)))]),[])}};function mn(t,r){return{broadcaster_id:e(t),user_id:e(r)}}o([ve(!1)],_n.prototype,"_getStreamByUserIdBatcher",void 0),o([ve(!1)],_n.prototype,"_getStreamByUserNameBatcher",void 0),_n=gn=o([te("api","HelixStreamApi")],_n);let yn=class extends pe{constructor(e,t){super(e),this._client=t}get broadcasterId(){return this[he].broadcaster_id}get broadcasterName(){return this[he].broadcaster_login}get broadcasterDisplayName(){return this[he].broadcaster_name}async getBroadcaster(){return await this._client.users.getUserById(this[he].broadcaster_id)}get isGift(){return this[he].is_gift}get tier(){return this[he].tier}};o([ve(!1)],yn.prototype,"_client",void 0),yn=o([te("api","HelixUserSubscription","broadcasterId")],yn);let wn=class extends yn{get broadcasterId(){return this[he].broadcaster_id}get broadcasterName(){return this[he].broadcaster_login}get broadcasterDisplayName(){return this[he].broadcaster_name}async getBroadcaster(){return Ce(await this._client.users.getUserById(this[he].broadcaster_id))}get gifterId(){return this[he].is_gift?this[he].gifter_id:null}get gifterName(){return this[he].is_gift?this[he].gifter_login:null}get gifterDisplayName(){return this[he].is_gift?this[he].gifter_name:null}async getGifter(){return this[he].is_gift?Ce(await this._client.users.getUserById(this[he].gifter_id)):null}get userId(){return this[he].user_id}get userName(){return this[he].user_login}get userDisplayName(){return this[he].user_name}async getUser(){return Ce(await this._client.users.getUserById(this[he].user_id))}};wn=o([te("api","HelixSubscription","userId")],wn);let fn=class extends $e{constructor(t,r){super({url:"subscriptions",scopes:["channel:read:subscriptions"],userId:e(t),query:fe(t)},r,(e=>new wn(e,r)))}async getPoints(){var e;return(null!==(e=this._currentData)&&void 0!==e?e:await this._fetchData({query:{after:void 0}})).points}};fn=o([te("api","HelixPaginatedSubscriptionsRequest")],fn);let bn=class extends xe{async getSubscriptions(t,r){const n=await this._client.callApi({url:"subscriptions",scopes:["channel:read:subscriptions"],type:"helix",userId:e(t),query:{...fe(t),...ze(r)}});return{...Ve(n,wn,this._client),points:n.points}}getSubscriptionsPaginated(e){return new fn(e,this._client)}async getSubscriptionsForUsers(t,r){return(await this._client.callApi({type:"helix",url:"subscriptions",userId:e(t),scopes:["channel:read:subscriptions"],query:Fe(t,r)})).data.map((e=>new wn(e,this._client)))}async getSubscriptionForUser(e,t){const r=await this.getSubscriptionsForUsers(e,[t]);return r.length?r[0]:null}async checkUserSubscription(t,r){try{const n=await this._client.callApi({type:"helix",url:"subscriptions/user",userId:e(t),scopes:["user:read:subscriptions"],query:mn(r,t)});return new yn(n.data[0],this._client)}catch(e){if(e instanceof Y&&404===e.statusCode)return null;throw e}}};bn=o([te("api","HelixSubscriptionApi")],bn);let vn=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].id}get name(){return this[he].team_name}get displayName(){return this[he].team_display_name}get backgroundImageUrl(){return this[he].background_image_url}get bannerUrl(){return this[he].banner}get creationDate(){return new Date(this[he].created_at)}get updateDate(){return new Date(this[he].updated_at)}get info(){return this[he].info}get logoThumbnailUrl(){return this[he].thumbnail_url}async getUserRelations(){return(await this._client.teams.getTeamById(this.id)).userRelations}};o([ve(!1)],vn.prototype,"_client",void 0),vn=o([te("api","HelixTeam","id")],vn);let xn=class extends vn{get userRelations(){return this[he].users.map((e=>new He(e,this._client)))}};xn=o([te("api","HelixTeamWithUsers","id")],xn);let In=class extends xe{async getTeamsForBroadcaster(t){var r,n;return null!==(n=null===(r=(await this._client.callApi({type:"helix",url:"teams/channel",userId:e(t),query:fe(t)})).data)||void 0===r?void 0:r.map((e=>new vn(e,this._client))))&&void 0!==n?n:[]}async getTeamById(e){try{const t=await this._client.callApi({type:"helix",url:"teams",query:{id:e}});return new xn(t.data[0],this._client)}catch(e){if(e instanceof Y&&500===e.statusCode)return null;throw e}}async getTeamByName(e){try{const t=await this._client.callApi({type:"helix",url:"teams",query:{name:e}});return new xn(t.data[0],this._client)}catch(e){if(e instanceof Y&&404===e.statusCode)return null;throw e}}};function Cn(t,r){return{target_user_id:e(t),source_context:r.sourceContext,reason:r.reason}}function Sn(t){return{target_user_id:e(t)}}In=o([te("api","HelixTeamApi")],In);class An extends pe{get id(){return this[he].id}get version(){return this[he].version}get name(){return this[he].name}}let Bn=class extends An{constructor(e,t,r){super(r),this._slotType=e,this._slotId=t}get slotType(){return this._slotType}get slotId(){return this._slotId}};Bn=o([te("api","HelixInstalledExtension","id")],Bn);let Tn=class extends pe{getExtensionAtSlot(e,t){const r=this[he][e][t];return r.active?new Bn(e,t,r):null}getExtensionsForSlotType(e){return[...Object.entries(this[he][e])].filter((e=>e[1].active)).map((([t,r])=>new Bn(e,t,r)))}getAllExtensions(){return[...Object.entries(this[he])].flatMap((([e,t])=>[...Object.entries(t)].filter((e=>e[1].active)).map((([t,r])=>new Bn(e,t,r)))))}};Tn=o([te("api","HelixInstalledExtensionList")],Tn);let En=class extends An{get canActivate(){return this[he].can_activate}get types(){return this[he].type}};En=o([te("api","HelixUserExtension","id")],En);let Un=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].id}get name(){return this[he].login}get displayName(){return this[he].display_name}get description(){return this[he].description}get type(){return this[he].type}get broadcasterType(){return this[he].broadcaster_type}get profilePictureUrl(){return this[he].profile_image_url}get offlinePlaceholderUrl(){return this[he].offline_image_url}get creationDate(){return new Date(this[he].created_at)}async getStream(){return await this._client.streams.getStreamByUserId(this)}async getFollowedChannels(){return await this._client.channels.getFollowedChannels(this)}async getFollowedChannel(e){var t;return null!==(t=(await this._client.channels.getFollowedChannels(this,e)).data[0])&&void 0!==t?t:null}async follows(e){return null!==await this.getFollowedChannel(e)}async getChannelFollowers(){return await this._client.channels.getChannelFollowers(this)}async getChannelFollower(e){var t;return null!==(t=(await this._client.channels.getChannelFollowers(this,e)).data[0])&&void 0!==t?t:null}async isFollowedBy(e){return null!==await this.getChannelFollower(e)}async getSubscriptionTo(e){return await this._client.subscriptions.checkUserSubscription(this,e)}async isSubscribedTo(e){return null!==await this.getSubscriptionTo(e)}async getSubscriber(e){return await this._client.subscriptions.getSubscriptionForUser(this,e)}async hasSubscriber(e){return null!==await this.getSubscriber(e)}};o([ve(!1)],Un.prototype,"_client",void 0),Un=o([te("api","HelixUser","id")],Un);let Dn=class extends Un{get email(){return this[he].email}async setDescription(e){return await this._client.users.updateAuthenticatedUser(this,{description:e})}};Dn=o([te("api","HelixPrivilegedUser","id")],Dn);let qn=class extends pe{constructor(e,t){super(e),this._client=t}get userId(){return this[he].user_id}get userName(){return this[he].user_login}get userDisplayName(){return this[he].display_name}async getUser(){return Ce(await this._client.users.getUserById(this[he].user_id))}};o([ve(!1)],qn.prototype,"_client",void 0),qn=o([te("api","HelixUserBlock","userId")],qn);let Pn=class extends xe{constructor(){super(...arguments),this._getUserByIdBatcher=new Me({url:"users"},"id","id",this._client,(e=>new Un(e,this._client))),this._getUserByNameBatcher=new Me({url:"users"},"login","login",this._client,(e=>new Un(e,this._client)))}async getUsersByIds(t){return await this._getUsers("id",t.map(e))}async getUsersByNames(e){return await this._getUsers("login",e.map(t))}async getUserById(t){const r=e(t);return f((await this._client.callApi({type:"helix",url:"users",userId:r,query:{id:r}})).data[0],(e=>new Un(e,this._client)))}async getUserByIdBatched(t){return await this._getUserByIdBatcher.request(e(t))}async getUserByName(e){const r=await this._getUsers("login",[t(e)]);return r.length?r[0]:null}async getUserByNameBatched(e){return await this._getUserByNameBatcher.request(t(e))}async getAuthenticatedUser(t,r=!1){var n;const s=await this._client.callApi({type:"helix",url:"users",forceType:"user",userId:e(t),scopes:r?["user:read:email"]:void 0});if(!(null===(n=s.data)||void 0===n?void 0:n.length))throw new ye("Could not get authenticated user");return new Dn(s.data[0],this._client)}async updateAuthenticatedUser(t,r){const n=await this._client.callApi({type:"helix",url:"users",method:"PUT",userId:e(t),scopes:["user:edit"],query:{description:r.description}});return new Dn(n.data[0],this._client)}async getBlocks(t,r){return We(await this._client.callApi({type:"helix",url:"users/blocks",userId:e(t),scopes:["user:read:blocked_users"],query:{...fe(t),...ze(r)}}),qn,this._client)}getBlocksPaginated(t){return new Ge({url:"users/blocks",userId:e(t),scopes:["user:read:blocked_users"],query:fe(t)},this._client,(e=>new qn(e,this._client)))}async createBlock(t,r,n={}){await this._client.callApi({type:"helix",url:"users/blocks",method:"PUT",userId:e(t),scopes:["user:manage:blocked_users"],query:Cn(r,n)})}async deleteBlock(t,r){await this._client.callApi({type:"helix",url:"users/blocks",method:"DELETE",userId:e(t),scopes:["user:manage:blocked_users"],query:Sn(r)})}async getExtensionsForAuthenticatedUser(t,r=!1){return(await this._client.callApi({type:"helix",url:"users/extensions/list",userId:e(t),scopes:r?["channel:manage:extensions"]:["user:read:broadcast","channel:manage:extensions"]})).data.map((e=>new En(e)))}async getActiveExtensions(t,r=!1){const n=e(t),s=await this._client.callApi({type:"helix",url:"users/extensions",userId:n,scopes:r?["user:read:broadcast","channel:manage:extensions"]:void 0,query:Oe("user_id",n)});return new Tn(s.data)}async updateActiveExtensionsForAuthenticatedUser(t,r){const n=await this._client.callApi({type:"helix",url:"users/extensions",method:"PUT",userId:e(t),scopes:["channel:manage:extensions"],jsonBody:{data:r}});return new Tn(n.data)}async _getUsers(e,t){if(0===t.length)return[];const r={[e]:t};return(await this._client.callApi({type:"helix",url:"users",query:r})).data.map((e=>new Un(e,this._client)))}};o([ve(!1)],Pn.prototype,"_getUserByIdBatcher",void 0),o([ve(!1)],Pn.prototype,"_getUserByNameBatcher",void 0),Pn=o([te("api","HelixUserApi")],Pn);let Rn=class extends pe{constructor(e,t){super(e),this._client=t}get id(){return this[he].id}get userId(){return this[he].user_id}get userName(){return this[he].user_login}get userDisplayName(){return this[he].user_name}async getUser(){return Ce(await this._client.users.getUserById(this[he].user_id))}get title(){return this[he].title}get description(){return this[he].description}get creationDate(){return new Date(this[he].created_at)}get publishDate(){return new Date(this[he].published_at)}get url(){return this[he].url}get thumbnailUrl(){return this[he].thumbnail_url}getThumbnailUrl(e,t){return this[he].thumbnail_url.replace("%{width}",e.toString()).replace("%{height}",t.toString())}get isPublic(){return"public"===this[he].viewable}get views(){return this[he].view_count}get language(){return this[he].language}get type(){return this[he].type}get duration(){return this[he].duration}get durationInSeconds(){const e=this[he].duration.match(/\d+[hms]/g);if(!e)throw new ye(`Could not parse duration string: ${this[he].duration}`);return e.map((e=>{const t=/(\d+)([hms])/.exec(e);if(!t)throw new ye(`Could not parse partial duration string: ${e}`);const[,r,n]=t;return parseInt(r,10)*{h:3600,m:60,s:1}[n]})).reduce(((e,t)=>e+t))}get streamId(){return this[he].stream_id}get mutedSegmentData(){var e,t;return null!==(t=null===(e=this[he].muted_segments)||void 0===e?void 0:e.slice())&&void 0!==t?t:[]}isMutedAt(e,t,r=!1){if(null===this[he].muted_segments)return!1;if(null==t)return this[he].muted_segments.some((t=>t.offset<=e&&e<=t.offset+t.duration));const n=e+t;return r?this[he].muted_segments.some((t=>{const r=t.offset+t.duration;return e<r&&t.offset<n})):this[he].muted_segments.some((t=>{const r=t.offset+t.duration;return t.offset<=e&&n<=r}))}};var On;o([ve(!1)],Rn.prototype,"_client",void 0),o([ae()],Rn.prototype,"durationInSeconds",null),Rn=o([le,te("api","HelixVideo","id")],Rn);let kn=On=class extends xe{constructor(){super(...arguments),this._getVideoByIdBatcher=new Me({url:"videos"},"id","id",this._client,(e=>new Rn(e,this._client)))}async getVideosByIds(e){return(await this._getVideos("id",e)).data}async getVideoById(e){const t=await this.getVideosByIds([e]);return t.length?t[0]:null}async getVideoByIdBatched(e){return await this._getVideoByIdBatcher.request(e)}async getVideosByUser(t,r={}){const n=e(t);return await this._getVideos("user_id",[n],r)}getVideosByUserPaginated(t,r={}){const n=e(t);return this._getVideosPaginated("user_id",[n],r)}async getVideosByGame(e,t={}){return await this._getVideos("game_id",[e],t)}getVideosByGamePaginated(e,t={}){return this._getVideosPaginated("game_id",[e],t)}async deleteVideosByIds(t,r){await this._client.callApi({type:"helix",url:"videos",method:"DELETE",scopes:["channel:manage:videos"],userId:e(t),query:{id:r}})}async _getVideos(e,t,r={}){return t.length?We(await this._client.callApi({type:"helix",url:"videos",userId:"user_id"===e?t[0]:void 0,query:{...On._makeVideosQuery(e,t,r),...ze(r)}}),Rn,this._client):{data:[]}}_getVideosPaginated(e,t,r={}){return new Ge({url:"videos",userId:"user_id"===e?t[0]:void 0,query:On._makeVideosQuery(e,t,r)},this._client,(e=>new Rn(e,this._client)))}static _makeVideosQuery(e,t,r={}){const{language:n,period:s,orderBy:i,type:a}=r;return{[e]:t,language:n,period:s,sort:i,type:a}}};function Nn(t,r){return{from_user_id:e(t),to_user_id:e(r)}}o([ve(!1)],kn.prototype,"_getVideoByIdBatcher",void 0),kn=On=o([te("api","HelixVideoApi")],kn);let jn=class extends xe{async sendWhisper(t,r,n){await this._client.callApi({type:"helix",url:"whispers",method:"POST",userId:e(t),scopes:["user:manage:whispers"],query:Nn(t,r),jsonBody:{message:n}})}};jn=o([te("api","HelixWhisperApi")],jn);class Fn{constructor(e,t,r){this._options=e,this._httpStatus=t,this._resolvedUserId=r}get options(){return this._options}get httpStatus(){return this._httpStatus}get resolvedUserId(){return this._resolvedUserId}}let Hn=class extends de{constructor(e,t,r){super(),this.onRequest=this.registerEvent(),this._config=e,this._logger=t,this._rateLimiter=r}async requestScopesForUser(e,t){await this._config.authProvider.getAccessTokenForUser(e,...t.map((e=>[e])))}async getTokenInfo(){try{const e=await this.callApi({type:"auth",url:"validate"});return new ge(e)}catch(e){if(e instanceof Y&&401===e.statusCode)throw new _e({cause:e});throw e}}async callApi(e){var t;const{authProvider:r}=this._config;if(null!==(t=e.auth)&&void 0!==t&&!t)return await async function(e,t,r,n,s={}){const i=await ee(e,t,r,n,s);return await X(i,e),await Z(i)}(e,r.clientId,void 0,void 0,this._config.fetchOptions);let n=!1;if(e.forceType)switch(e.forceType){case"app":{if(!r.getAppAccessToken)throw new Error("Tried to make an API call that requires an app access token but your auth provider does not support that");const t=await r.getAppAccessToken();return await this._callApiUsingInitialToken(e,t)}case"user":n=!0;break;default:throw new ye(`Unknown forced token type: ${e.forceType}`)}if(e.scopes&&(n=!0),n){const t=e.canOverrideScopedUserContext?this._getUserIdFromRequestContext(e.userId):e.userId;if(!t)throw new Error("Tried to make an API call with a user context but no context user ID");const n=await r.getAccessTokenForUser(t,e.scopes);if(!n)throw new Error(`Tried to make an API call with a user context for user ID ${t} but no token was found`);if(me(n)&&r.refreshAccessTokenForUser){const n=await r.refreshAccessTokenForUser(t);return await this._callApiUsingInitialToken(e,n,!0)}return await this._callApiUsingInitialToken(e,n)}const s=this._getUserIdFromRequestContext(e.userId),i=null===s?await r.getAnyAccessToken():await r.getAnyAccessToken(null!=s?s:e.userId);if(me(i)&&i.userId&&r.refreshAccessTokenForUser){const t=await r.refreshAccessTokenForUser(i.userId);return await this._callApiUsingInitialToken(e,t,!0)}return await this._callApiUsingInitialToken(e,i)}get bits(){return new Ee(this)}get channels(){return new et(this)}get channelPoints(){return new lt(this)}get charity(){return new ht(this)}get chat(){return new Et(this)}get clips(){return new Pt(this)}get contentClassificationLabels(){return new Ot(this)}get entitlements(){return new Ft(this)}get eventSub(){return new Yt(this)}get extensions(){return new ir(this)}get games(){return new or(this)}get hypeTrain(){return new hr(this)}get goals(){return new cr(this)}get moderation(){return new qr(this)}get polls(){return new Nr(this)}get predictions(){return new Gr(this)}get raids(){return new Vr(this)}get schedule(){return new tn(this)}get search(){return new sn(this)}get streams(){return new _n(this)}get subscriptions(){return new bn(this)}get teams(){return new In(this)}get users(){return new Pn(this)}get videos(){return new kn(this)}get whispers(){return new jn(this)}get rateLimiterStats(){return this._rateLimiter instanceof W?this._rateLimiter.stats:null}get _authProvider(){return this._config.authProvider}get _mockServerPort(){return this._config.mockServerPort}get _batchDelay(){var e;return null!==(e=this._config.batchDelay)&&void 0!==e?e:0}_getUserIdFromRequestContext(e){return e}async _callApiUsingInitialToken(e,t,r=!1){var n;const{authProvider:s}=this._config,{authorizationType:i}=s;let a=await this._callApiInternal(e,s.clientId,t.accessToken,i);if(401===a.status&&!r)if(t.userId){if(s.refreshAccessTokenForUser){const r=await s.refreshAccessTokenForUser(t.userId);a=await this._callApiInternal(e,s.clientId,r.accessToken,i)}}else if(s.getAppAccessToken){const t=await s.getAppAccessToken(!0);a=await this._callApiInternal(e,s.clientId,t.accessToken,i)}return this.emit(this.onRequest,new Fn(e,a.status,null!==(n=t.userId)&&void 0!==n?n:null)),await X(a,e),await Z(a)}async _callApiInternal(e,t,r,n){var s,i,a;const{fetchOptions:o,mockServerPort:l}=this._config,c=null!==(s=e.type)&&void 0!==s?s:"helix";this._logger.debug(`Calling ${c} API: ${null!==(i=e.method)&&void 0!==i?i:"GET"} ${e.url}`),this._logger.trace(`Query: ${JSON.stringify(e.query)}`),e.jsonBody&&this._logger.trace(`Request body: ${JSON.stringify(e.jsonBody)}`);const u=we.operation({retries:3,minTimeout:500,factor:2}),{promise:d,resolve:h,reject:p}=ce();u.attempt((async()=>{try{const s="helix"===c?await this._rateLimiter.request({options:e,clientId:t,accessToken:r,authorizationType:n,fetchOptions:o,mockServerPort:l}):await ee(e,t,r,n,o,l);!s.ok&&s.status>=500&&s.status<600&&await X(s,e),h(s)}catch(e){if(u.retry(e))return;p(u.mainError())}}));const g=await d;return this._logger.debug(`Called ${c} API: ${null!==(a=e.method)&&void 0!==a?a:"GET"} ${e.url} - result: ${g.status}`),g}};o([ae()],Hn.prototype,"bits",null),o([ae()],Hn.prototype,"channels",null),o([ae()],Hn.prototype,"channelPoints",null),o([ae()],Hn.prototype,"charity",null),o([ae()],Hn.prototype,"chat",null),o([ae()],Hn.prototype,"clips",null),o([ae()],Hn.prototype,"contentClassificationLabels",null),o([ae()],Hn.prototype,"entitlements",null),o([ae()],Hn.prototype,"eventSub",null),o([ae()],Hn.prototype,"extensions",null),o([ae()],Hn.prototype,"games",null),o([ae()],Hn.prototype,"hypeTrain",null),o([ae()],Hn.prototype,"goals",null),o([ae()],Hn.prototype,"moderation",null),o([ae()],Hn.prototype,"polls",null),o([ae()],Hn.prototype,"predictions",null),o([ae()],Hn.prototype,"raids",null),o([ae()],Hn.prototype,"schedule",null),o([ae()],Hn.prototype,"search",null),o([ae()],Hn.prototype,"streams",null),o([ae()],Hn.prototype,"subscriptions",null),o([ae()],Hn.prototype,"teams",null),o([ae()],Hn.prototype,"users",null),o([ae()],Hn.prototype,"videos",null),o([ae()],Hn.prototype,"whispers",null),Hn=o([le,te("api","ApiClient")],Hn);let Mn=class extends Hn{_getUserIdFromRequestContext(){return null}};Mn=o([te("api","ApiClient")],Mn);let Ln=class extends Hn{constructor(e,t,r,n){super(e,t,r),this._userId=n}_getUserIdFromRequestContext(){return this._userId}};Ln=o([te("api","ApiClient")],Ln);let Gn=class extends Hn{constructor(e){if(!e.authProvider)throw new re("No auth provider given. Please supply the `authProvider` option.");const t={name:"twurple:api:rate-limiter",...e.logger};super(e,M({name:"twurple:api:client",...e.logger}),h.L?new V({getPartitionKey:e=>{var t;return null!==(t=e.userId)&&void 0!==t?t:null},createChild:()=>new ne({logger:t})}):new z({logger:t,bucketSize:800,timeFrame:64e3,doRequest:async({options:e,clientId:t,accessToken:r,authorizationType:n,fetchOptions:s,mockServerPort:i})=>await ee(e,t,r,n,s,i),getPartitionKey:e=>{var t;return null!==(t=e.userId)&&void 0!==t?t:null}}))}async asUser(t,r){const n=new Ln(this._config,this._logger,this._rateLimiter,e(t));return await r(n)}async asIntent(e,t){if(!this._authProvider.getAccessTokenForIntent)throw new Error("Trying to use intents with an auth provider that does not support them");for(const r of e){const e=await this._authProvider.getAccessTokenForIntent(r);if(e){const r=new Ln(this._config,this._logger,this._rateLimiter,e.userId);return await t(r)}}throw new Error(`Intents [${e.join(", ")}] not found in auth provider`)}async withoutUser(e){const t=new Mn(this._config,this._logger,this._rateLimiter);return await e(t)}};async function $n(){const e=new s("lalrvvljueuwdj1l778y6jcsuktevq");try{console.info("Fetching user name...");const t=new Gn({authProvider:e}),r=await t.users.getUserByName("aluthecrow");return console.log("User name fetched:",r.displayName),r.displayName}catch(e){return console.error("Error fetching user name:",e),null}}Gn=o([te("api","ApiClient")],Gn)})(),jslib=n})();